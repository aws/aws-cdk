{
    "typeName": "AWS::ECS::CapacityProvider",
    "description": "Resource Type definition for AWS::ECS::CapacityProvider.",
    "definitions": {
        "ManagedScaling": {
            "description": "The managed scaling settings for the Auto Scaling group capacity provider.",
            "type": "object",
            "properties": {
                "MinimumScalingStepSize": {
                    "type": "integer"
                },
                "MaximumScalingStepSize": {
                    "type": "integer"
                },
                "Status": {
                    "type": "string",
                    "enum": [
                        "DISABLED",
                        "ENABLED"
                    ]
                },
                "TargetCapacity": {
                    "type": "integer"
                },
                "InstanceWarmupPeriod": {
                    "type": "integer"
                }
            },
            "additionalProperties": false
        },
        "AutoScalingGroupProvider": {
            "type": "object",
            "properties": {
                "AutoScalingGroupArn": {
                    "type": "string"
                },
                "ManagedScaling": {
                    "$ref": "#/definitions/ManagedScaling"
                },
                "ManagedTerminationProtection": {
                    "type": "string",
                    "enum": [
                        "DISABLED",
                        "ENABLED"
                    ]
                },
                "ManagedDraining": {
                    "type": "string",
                    "enum": [
                        "DISABLED",
                        "ENABLED"
                    ]
                }
            },
            "required": [
                "AutoScalingGroupArn"
            ],
            "additionalProperties": false
        },
        "ManagedInstancesProvider": {
            "type": "object",
            "properties": {
                "InfrastructureRoleArn": {
                    "type": "string"
                },
                "InstanceLaunchTemplate": {
                    "$ref": "#/definitions/InstanceLaunchTemplate"
                },
                "PropagateTags": {
                    "type": "string",
                    "enum": [
                        "CAPACITY_PROVIDER",
                        "NONE"
                    ]
                }
            },
            "required": [
                "InfrastructureRoleArn",
                "InstanceLaunchTemplate"
            ],
            "additionalProperties": false
        },
        "InstanceLaunchTemplate": {
            "type": "object",
            "properties": {
                "Ec2InstanceProfileArn": {
                    "type": "string"
                },
                "NetworkConfiguration": {
                    "$ref": "#/definitions/ManagedInstancesNetworkConfiguration"
                },
                "StorageConfiguration": {
                    "$ref": "#/definitions/ManagedInstancesStorageConfiguration"
                },
                "Monitoring": {
                    "$ref": "#/definitions/ManagedInstancesMonitoringOptions"
                },
                "InstanceRequirements": {
                    "$ref": "#/definitions/InstanceRequirementsRequest"
                }
            },
            "additionalProperties": false,
            "required": [
                "Ec2InstanceProfileArn",
                "NetworkConfiguration"
            ]
        },
        "ManagedInstancesNetworkConfiguration": {
            "type": "object",
            "properties": {
                "SecurityGroups": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "Subnets": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "Subnets"
            ],
            "additionalProperties": false
        },
        "ManagedInstancesStorageConfiguration": {
            "type": "object",
            "properties": {
                "StorageSizeGiB": {
                    "type": "integer"
                }
            },
            "required": [
                "StorageSizeGiB"
            ],
            "additionalProperties": false
        },
        "ManagedInstancesMonitoringOptions": {
            "type": "string",
            "enum": [
                "BASIC",
                "DETAILED"
            ]
        },
        "InstanceRequirementsRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "VCpuCount": {
                    "$ref": "#/definitions/VCpuCountRangeRequest"
                },
                "MemoryMiB": {
                    "$ref": "#/definitions/MemoryMiBRequest"
                },
                "CpuManufacturers": {
                    "type": "array",
                    "uniqueItems": false,
                    "items": {
                        "type": "string",
                        "enum": [
                            "intel",
                            "amd",
                            "amazon-web-services"
                        ]
                    }
                },
                "MemoryGiBPerVCpu": {
                    "$ref": "#/definitions/MemoryGiBPerVCpuRequest"
                },
                "AllowedInstanceTypes": {
                    "type": "array",
                    "uniqueItems": false,
                    "items": {
                        "type": "string",
                        "minLength": 1,
                        "maxLength": 30,
                        "pattern": "[a-zA-Z0-9\\.\\*]+"
                    }
                },
                "ExcludedInstanceTypes": {
                    "type": "array",
                    "uniqueItems": false,
                    "items": {
                        "type": "string",
                        "minLength": 1,
                        "maxLength": 30,
                        "pattern": "[a-zA-Z0-9\\.\\*]+"
                    }
                },
                "InstanceGenerations": {
                    "type": "array",
                    "uniqueItems": false,
                    "items": {
                        "type": "string",
                        "enum": [
                            "current",
                            "previous"
                        ]
                    }
                },
                "SpotMaxPricePercentageOverLowestPrice": {
                    "type": "integer"
                },
                "OnDemandMaxPricePercentageOverLowestPrice": {
                    "type": "integer"
                },
                "MaxSpotPriceAsPercentageOfOptimalOnDemandPrice": {
                    "type": "integer"
                },
                "BareMetal": {
                    "type": "string",
                    "enum": [
                        "included",
                        "required",
                        "excluded"
                    ]
                },
                "BurstablePerformance": {
                    "type": "string",
                    "enum": [
                        "included",
                        "required",
                        "excluded"
                    ]
                },
                "RequireHibernateSupport": {
                    "type": "boolean"
                },
                "NetworkBandwidthGbps": {
                    "$ref": "#/definitions/NetworkBandwidthGbpsRequest"
                },
                "NetworkInterfaceCount": {
                    "$ref": "#/definitions/NetworkInterfaceCountRequest"
                },
                "LocalStorage": {
                    "type": "string",
                    "enum": [
                        "included",
                        "required",
                        "excluded"
                    ]
                },
                "LocalStorageTypes": {
                    "type": "array",
                    "uniqueItems": false,
                    "items": {
                        "type": "string",
                        "enum": [
                            "hdd",
                            "ssd"
                        ]
                    }
                },
                "TotalLocalStorageGB": {
                    "$ref": "#/definitions/TotalLocalStorageGBRequest"
                },
                "BaselineEbsBandwidthMbps": {
                    "$ref": "#/definitions/BaselineEbsBandwidthMbpsRequest"
                },
                "AcceleratorTypes": {
                    "type": "array",
                    "uniqueItems": false,
                    "items": {
                        "type": "string",
                        "enum": [
                            "gpu",
                            "fpga",
                            "inference"
                        ]
                    }
                },
                "AcceleratorCount": {
                    "$ref": "#/definitions/AcceleratorCountRequest"
                },
                "AcceleratorManufacturers": {
                    "type": "array",
                    "uniqueItems": false,
                    "items": {
                        "type": "string",
                        "enum": [
                            "amazon-web-services",
                            "amd",
                            "habana",
                            "nvidia",
                            "xilinx"
                        ]
                    }
                },
                "AcceleratorNames": {
                    "type": "array",
                    "uniqueItems": false,
                    "items": {
                        "type": "string",
                        "enum": [
                            "a10g",
                            "a100",
                            "h100",
                            "inferentia",
                            "k520",
                            "k80",
                            "m60",
                            "radeon-pro-v520",
                            "t4",
                            "t4g",
                            "vu9p",
                            "v100"
                        ]
                    }
                },
                "AcceleratorTotalMemoryMiB": {
                    "$ref": "#/definitions/AcceleratorTotalMemoryMiBRequest"
                }
            },
            "required": [
                "VCpuCount",
                "MemoryMiB"
            ]
        },
        "VCpuCountRangeRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "Min": {
                    "type": "integer"
                },
                "Max": {
                    "type": "integer"
                }
            },
            "required": [
                "Min"
            ]
        },
        "MemoryMiBRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "Min": {
                    "type": "integer"
                },
                "Max": {
                    "type": "integer"
                }
            },
            "required": [
                "Min"
            ]
        },
        "MemoryGiBPerVCpuRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "Min": {
                    "type": "number"
                },
                "Max": {
                    "type": "number"
                }
            }
        },
        "NetworkBandwidthGbpsRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "Min": {
                    "type": "number"
                },
                "Max": {
                    "type": "number"
                }
            }
        },
        "NetworkInterfaceCountRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "Min": {
                    "type": "integer"
                },
                "Max": {
                    "type": "integer"
                }
            }
        },
        "TotalLocalStorageGBRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "Min": {
                    "type": "number"
                },
                "Max": {
                    "type": "number"
                }
            }
        },
        "BaselineEbsBandwidthMbpsRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "Min": {
                    "type": "integer"
                },
                "Max": {
                    "type": "integer"
                }
            }
        },
        "AcceleratorCountRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "Min": {
                    "type": "integer"
                },
                "Max": {
                    "type": "integer"
                }
            }
        },
        "AcceleratorTotalMemoryMiBRequest": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "Min": {
                    "type": "integer"
                },
                "Max": {
                    "type": "integer"
                }
            }
        },
        "Tag": {
            "type": "object",
            "properties": {
                "Key": {
                    "type": "string",
                    "minLength": 1
                },
                "Value": {
                    "type": "string",
                    "minLength": 1
                }
            },
            "additionalProperties": false
        }
    },
    "nonPublicProperties": [
        "/properties/ECSEndpoint"
    ],
    "properties": {
        "AutoScalingGroupProvider": {
            "$ref": "#/definitions/AutoScalingGroupProvider"
        },
        "Name": {
            "type": "string"
        },
        "ECSEndpoint": {
            "type": "string"
        },
        "Tags": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/Tag"
            }
        },
        "ClusterName": {
            "type": "string"
        },
        "ManagedInstancesProvider": {
            "$ref": "#/definitions/ManagedInstancesProvider"
        }
    },
    "additionalProperties": false,
    "primaryIdentifier": [
        "/properties/Name"
    ],
    "createOnlyProperties": [
        "/properties/AutoScalingGroupProvider/AutoScalingGroupArn",
        "/properties/Name",
        "/properties/ClusterName"
    ],
    "propertyTransform": {
        "/properties/AutoScalingGroupProvider/AutoScalingGroupArn": "$split(AutoScalingGroupProvider.AutoScalingGroupArn, \"autoScalingGroupName\/\")[-1] $OR $split(AutoScalingGroupArn, \"autoScalingGroupName\/\")[-1]"
    },
    "tagging": {
        "taggable": true,
        "tagOnCreate": true,
        "tagUpdatable": true,
        "cloudFormationSystemTags": true,
        "tagProperty": "/properties/Tags",
        "permissions": [
            "ecs:TagResource",
            "ecs:UntagResource",
            "ecs:ListTagsForResource"
        ]
    },
    "handlers": {
        "create": {
            "permissions": [
                "autoscaling:CreateOrUpdateTags",
                "ecs:CreateCapacityProvider",
                "ecs:DescribeCapacityProviders",
                "ecs:TagResource",
                "ecs:PutClusterCapacityProviders",
                "iam:CreateServiceLinkedRole",
                "iam:PassRole"
            ]
        },
        "delete": {
            "permissions": [
                "ecs:DescribeCapacityProviders",
                "ecs:DeleteCapacityProvider",
                "ecs:PutClusterCapacityProviders"
            ]
        },
        "read": {
            "permissions": [
                "ecs:DescribeCapacityProviders"
            ]
        },
        "update": {
            "permissions": [
                "ecs:UpdateCapacityProvider",
                "ecs:DescribeCapacityProviders",
                "ecs:ListTagsForResource",
                "ecs:PutClusterCapacityProviders",
                "ecs:TagResource",
                "ecs:UntagResource",
                "iam:PassRole"
            ]
        },
        "list": {
            "permissions": [
                "ecs:DescribeCapacityProviders"
            ]
        }
    }
}