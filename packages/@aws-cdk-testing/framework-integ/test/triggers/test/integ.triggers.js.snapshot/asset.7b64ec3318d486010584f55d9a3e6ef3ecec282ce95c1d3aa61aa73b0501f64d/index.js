"use strict";var a=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var h=(e,o)=>{for(var n in o)a(e,n,{get:o[n],enumerable:!0})},T=(e,o,n,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of y(o))!w.call(e,r)&&r!==n&&a(e,r,{get:()=>o[r],enumerable:!(t=g(o,r))||t.enumerable});return e};var R=e=>T(a({},"__esModule",{value:!0}),e);var I={};h(I,{handler:()=>v,invoke:()=>p});module.exports=R(I);var l=require("@aws-sdk/client-lambda"),d=require("@aws-sdk/node-http-handler"),E=e=>{if(e)return new TextDecoder().decode(Buffer.from(e))},p=async(e,o,n)=>{let t=new l.Lambda({requestHandler:new d.NodeHttpHandler({socketTimeout:n})}),r={FunctionName:e,InvocationType:o};console.log({invokeRequest:r});let s=0,m=5e3,i;for(;;)try{i=await t.invoke(r);break}catch(u){if(u.name==="AccessDeniedException"&&s<12){s++,await new Promise(f=>{setTimeout(f,m)});continue}throw u}let c={...i,Payload:E(i.Payload)};return console.log({invokeResponse:c}),c};async function v(e){if(console.log({...e,ResponseURL:"..."}),e.RequestType==="Delete"){console.log("not calling trigger on DELETE");return}if(e.RequestType==="Update"&&e.ResourceProperties.ExecuteOnHandlerChange==="false"){console.log("not calling trigger because ExecuteOnHandlerChange is false");return}let o=e.ResourceProperties.HandlerArn;if(!o)throw new Error('The "HandlerArn" property is required');let n=e.ResourceProperties.InvocationType,t=e.ResourceProperties.Timeout,r=parseInt(t);if(isNaN(r))throw new Error(`The "Timeout" property with value ${t} is not parsable to a number`);let s=await p(o,n,r);if(s.StatusCode&&s.StatusCode>=400)throw new Error(`Trigger handler failed with status code ${s.StatusCode}`);if(s.FunctionError)throw new Error(P(s.Payload))}function P(e){if(!e)return"unknown handler error";console.log(`Error payload: ${e}`);try{let o=JSON.parse(e),n=[o.errorMessage,o.trace].filter(t=>t).join(`
`);return n.length>0?n:e}catch{return e}}0&&(module.exports={handler,invoke});
