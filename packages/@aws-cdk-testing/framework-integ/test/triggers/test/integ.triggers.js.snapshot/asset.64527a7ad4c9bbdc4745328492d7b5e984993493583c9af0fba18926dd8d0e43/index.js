"use strict";var Be=Object.create;var S=Object.defineProperty;var Qe=Object.getOwnPropertyDescriptor;var We=Object.getOwnPropertyNames;var Ke=Object.getPrototypeOf,Ve=Object.prototype.hasOwnProperty;var H=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ye=(t,e)=>{for(var r in e)S(t,r,{get:e[r],enumerable:!0})},Q=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of We(e))!Ve.call(t,n)&&n!==r&&S(t,n,{get:()=>e[n],enumerable:!(o=Qe(e,n))||o.enumerable});return t};var Je=(t,e,r)=>(r=t!=null?Be(Ke(t)):{},Q(e||!t||!t.__esModule?S(r,"default",{value:t,enumerable:!0}):r,t)),ze=t=>Q(S({},"__esModule",{value:!0}),t);var ee=H((cr,Z)=>{"use strict";var O=Object.defineProperty,Xe=Object.getOwnPropertyDescriptor,Ge=Object.getOwnPropertyNames,Ze=Object.prototype.hasOwnProperty,A=(t,e)=>O(t,"name",{value:e,configurable:!0}),et=(t,e)=>{for(var r in e)O(t,r,{get:e[r],enumerable:!0})},tt=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ge(e))!Ze.call(t,n)&&n!==r&&O(t,n,{get:()=>e[n],enumerable:!(o=Xe(e,n))||o.enumerable});return t},rt=t=>tt(O({},"__esModule",{value:!0}),t),W={};et(W,{AlgorithmId:()=>J,EndpointURLScheme:()=>Y,FieldPosition:()=>z,HttpApiKeyAuthLocation:()=>V,HttpAuthLocation:()=>K,IniSectionType:()=>X,RequestHandlerProtocol:()=>G,SMITHY_CONTEXT_KEY:()=>at,getDefaultClientConfiguration:()=>st,resolveDefaultRuntimeConfig:()=>it});Z.exports=rt(W);var K=(t=>(t.HEADER="header",t.QUERY="query",t))(K||{}),V=(t=>(t.HEADER="header",t.QUERY="query",t))(V||{}),Y=(t=>(t.HTTP="http",t.HTTPS="https",t))(Y||{}),J=(t=>(t.MD5="md5",t.CRC32="crc32",t.CRC32C="crc32c",t.SHA1="sha1",t.SHA256="sha256",t))(J||{}),ot=A(t=>{let e=[];return t.sha256!==void 0&&e.push({algorithmId:()=>"sha256",checksumConstructor:()=>t.sha256}),t.md5!=null&&e.push({algorithmId:()=>"md5",checksumConstructor:()=>t.md5}),{_checksumAlgorithms:e,addChecksumAlgorithm(r){this._checksumAlgorithms.push(r)},checksumAlgorithms(){return this._checksumAlgorithms}}},"getChecksumConfiguration"),nt=A(t=>{let e={};return t.checksumAlgorithms().forEach(r=>{e[r.algorithmId()]=r.checksumConstructor()}),e},"resolveChecksumRuntimeConfig"),st=A(t=>({...ot(t)}),"getDefaultClientConfiguration"),it=A(t=>({...nt(t)}),"resolveDefaultRuntimeConfig"),z=(t=>(t[t.HEADER=0]="HEADER",t[t.TRAILER=1]="TRAILER",t))(z||{}),at="__smithy_context",X=(t=>(t.PROFILE="profile",t.SSO_SESSION="sso-session",t.SERVICES="services",t))(X||{}),G=(t=>(t.HTTP_0_9="http/0.9",t.HTTP_1_0="http/1.0",t.TDS_8_0="tds/8.0",t))(G||{})});var le=H((hr,ue)=>{"use strict";var k=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,ut=Object.getOwnPropertyNames,lt=Object.prototype.hasOwnProperty,E=(t,e)=>k(t,"name",{value:e,configurable:!0}),dt=(t,e)=>{for(var r in e)k(t,r,{get:e[r],enumerable:!0})},ht=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ut(e))!lt.call(t,n)&&n!==r&&k(t,n,{get:()=>e[n],enumerable:!(o=ct(e,n))||o.enumerable});return t},ft=t=>ht(k({},"__esModule",{value:!0}),t),te={};dt(te,{Field:()=>gt,Fields:()=>vt,HttpRequest:()=>yt,HttpResponse:()=>_t,IHttpRequest:()=>re.HttpRequest,getHttpHandlerExtensionConfiguration:()=>pt,isValidHostname:()=>ce,resolveHttpHandlerRuntimeConfig:()=>mt});ue.exports=ft(te);var pt=E(t=>{let e=t.httpHandler;return{setHttpHandler(r){e=r},httpHandler(){return e},updateHttpClientConfig(r,o){e.updateHttpClientConfig(r,o)},httpHandlerConfigs(){return e.httpHandlerConfigs()}}},"getHttpHandlerExtensionConfiguration"),mt=E(t=>({httpHandler:t.httpHandler()}),"resolveHttpHandlerRuntimeConfig"),re=ee(),oe=class{constructor({name:e,kind:r=re.FieldPosition.HEADER,values:o=[]}){this.name=e,this.kind=r,this.values=o}add(e){this.values.push(e)}set(e){this.values=e}remove(e){this.values=this.values.filter(r=>r!==e)}toString(){return this.values.map(e=>e.includes(",")||e.includes(" ")?`"${e}"`:e).join(", ")}get(){return this.values}};E(oe,"Field");var gt=oe,ne=class{constructor({fields:e=[],encoding:r="utf-8"}){this.entries={},e.forEach(this.setField.bind(this)),this.encoding=r}setField(e){this.entries[e.name.toLowerCase()]=e}getField(e){return this.entries[e.toLowerCase()]}removeField(e){delete this.entries[e.toLowerCase()]}getByType(e){return Object.values(this.entries).filter(r=>r.kind===e)}};E(ne,"Fields");var vt=ne,se=class j{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?e.protocol.slice(-1)!==":"?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?e.path.charAt(0)!=="/"?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static clone(e){let r=new j({...e,headers:{...e.headers}});return r.query&&(r.query=ie(r.query)),r}static isInstance(e){if(!e)return!1;let r=e;return"method"in r&&"protocol"in r&&"hostname"in r&&"path"in r&&typeof r.query=="object"&&typeof r.headers=="object"}clone(){return j.clone(this)}};E(se,"HttpRequest");var yt=se;function ie(t){return Object.keys(t).reduce((e,r)=>{let o=t[r];return{...e,[r]:Array.isArray(o)?[...o]:o}},{})}E(ie,"cloneQuery");var ae=class{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;let r=e;return typeof r.statusCode=="number"&&typeof r.headers=="object"}};E(ae,"HttpResponse");var _t=ae;function ce(t){return/^[a-z0-9][a-z0-9\.\-]*[a-z0-9]$/.test(t)}E(ce,"isValidHostname")});var pe=H((fr,fe)=>{"use strict";var x=Object.defineProperty,Et=Object.getOwnPropertyDescriptor,bt=Object.getOwnPropertyNames,Ct=Object.prototype.hasOwnProperty,U=(t,e)=>x(t,"name",{value:e,configurable:!0}),wt=(t,e)=>{for(var r in e)x(t,r,{get:e[r],enumerable:!0})},Tt=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of bt(e))!Ct.call(t,n)&&n!==r&&x(t,n,{get:()=>e[n],enumerable:!(o=Et(e,n))||o.enumerable});return t},Ht=t=>Tt(x({},"__esModule",{value:!0}),t),de={};wt(de,{escapeUri:()=>he,escapeUriPath:()=>Rt});fe.exports=Ht(de);var he=U(t=>encodeURIComponent(t).replace(/[!'()*]/g,Pt),"escapeUri"),Pt=U(t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`,"hexEncode"),Rt=U(t=>t.split("/").map(he).join("/"),"escapeUriPath")});var ye=H((pr,ve)=>{"use strict";var D=Object.defineProperty,St=Object.getOwnPropertyDescriptor,Ot=Object.getOwnPropertyNames,At=Object.prototype.hasOwnProperty,kt=(t,e)=>D(t,"name",{value:e,configurable:!0}),xt=(t,e)=>{for(var r in e)D(t,r,{get:e[r],enumerable:!0})},Dt=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ot(e))!At.call(t,n)&&n!==r&&D(t,n,{get:()=>e[n],enumerable:!(o=St(e,n))||o.enumerable});return t},Nt=t=>Dt(D({},"__esModule",{value:!0}),t),me={};xt(me,{buildQueryString:()=>ge});ve.exports=Nt(me);var I=pe();function ge(t){let e=[];for(let r of Object.keys(t).sort()){let o=t[r];if(r=(0,I.escapeUri)(r),Array.isArray(o))for(let n=0,s=o.length;n<s;n++)e.push(`${r}=${(0,I.escapeUri)(o[n])}`);else{let n=r;(o||typeof o=="string")&&(n+=`=${(0,I.escapeUri)(o)}`),e.push(n)}}return e.join("&")}kt(ge,"buildQueryString")});var Le=H((yr,Ie)=>{"use strict";var jt=Object.create,P=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,It=Object.getOwnPropertyNames,Lt=Object.getPrototypeOf,$t=Object.prototype.hasOwnProperty,u=(t,e)=>P(t,"name",{value:e,configurable:!0}),Ft=(t,e)=>{for(var r in e)P(t,r,{get:e[r],enumerable:!0})},we=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of It(e))!$t.call(t,n)&&n!==r&&P(t,n,{get:()=>e[n],enumerable:!(o=Ut(e,n))||o.enumerable});return t},Mt=(t,e,r)=>(r=t!=null?jt(Lt(t)):{},we(e||!t||!t.__esModule?P(r,"default",{value:t,enumerable:!0}):r,t)),qt=t=>we(P({},"__esModule",{value:!0}),t),Te={};Ft(Te,{DEFAULT_REQUEST_TIMEOUT:()=>Yt,NodeHttp2Handler:()=>Zt,NodeHttpHandler:()=>Jt,streamCollector:()=>tr});Ie.exports=qt(Te);var He=le(),Pe=ye(),L=require("http"),$=require("https"),Bt=["ECONNRESET","EPIPE","ETIMEDOUT"],Re=u(t=>{let e={};for(let r of Object.keys(t)){let o=t[r];e[r]=Array.isArray(o)?o.join(","):o}return e},"getTransformedHeaders"),_e=1e3,Qt=u((t,e,r=0)=>{if(!r)return-1;let o=u(n=>{let s=setTimeout(()=>{t.destroy(),e(Object.assign(new Error(`Socket timed out without establishing a connection within ${r} ms`),{name:"TimeoutError"}))},r-n),i=u(a=>{a?.connecting?a.on("connect",()=>{clearTimeout(s)}):clearTimeout(s)},"doWithSocket");t.socket?i(t.socket):t.on("socket",i)},"registerTimeout");return r<2e3?(o(0),0):setTimeout(o.bind(null,_e),_e)},"setConnectionTimeout"),Wt=3e3,Kt=u((t,{keepAlive:e,keepAliveMsecs:r},o=Wt)=>{if(e!==!0)return-1;let n=u(()=>{t.socket?t.socket.setKeepAlive(e,r||0):t.on("socket",s=>{s.setKeepAlive(e,r||0)})},"registerListener");return o===0?(n(),0):setTimeout(n,o)},"setSocketKeepAlive"),Ee=3e3,Vt=u((t,e,r=0)=>{let o=u(n=>{t.setTimeout(r-n,()=>{t.destroy(),e(Object.assign(new Error(`Connection timed out after ${r} ms`),{name:"TimeoutError"}))})},"registerTimeout");return 0<r&&r<6e3?(o(0),0):setTimeout(o.bind(null,r===0?0:Ee),Ee)},"setSocketTimeout"),Se=require("stream"),be=1e3;async function M(t,e,r=be){let o=e.headers??{},n=o.Expect||o.expect,s=-1,i=!1;n==="100-continue"&&await Promise.race([new Promise(a=>{s=Number(setTimeout(a,Math.max(be,r)))}),new Promise(a=>{t.on("continue",()=>{clearTimeout(s),a()}),t.on("error",()=>{i=!0,clearTimeout(s),a()})})]),i||Oe(t,e.body)}u(M,"writeRequestBody");function Oe(t,e){if(e instanceof Se.Readable){e.pipe(t);return}if(e){if(Buffer.isBuffer(e)||typeof e=="string"){t.end(e);return}let r=e;if(typeof r=="object"&&r.buffer&&typeof r.byteOffset=="number"&&typeof r.byteLength=="number"){t.end(Buffer.from(r.buffer,r.byteOffset,r.byteLength));return}t.end(Buffer.from(e));return}t.end()}u(Oe,"writeBody");var Yt=0,Ae=class F{constructor(e){this.socketWarningTimestamp=0,this.metadata={handlerProtocol:"http/1.1"},this.configProvider=new Promise((r,o)=>{typeof e=="function"?e().then(n=>{r(this.resolveDefaultConfig(n))}).catch(o):r(this.resolveDefaultConfig(e))})}static create(e){return typeof e?.handle=="function"?e:new F(e)}static checkSocketUsage(e,r,o=console){var n,s,i;let{sockets:a,requests:c,maxSockets:f}=e;if(typeof f!="number"||f===1/0||Date.now()-15e3<r)return r;if(a&&c)for(let v in a){let C=((n=a[v])==null?void 0:n.length)??0,y=((s=c[v])==null?void 0:s.length)??0;if(C>=f&&y>=2*f)return(i=o?.warn)==null||i.call(o,`@smithy/node-http-handler:WARN - socket usage at capacity=${C} and ${y} additional requests are enqueued.
See https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/node-configuring-maxsockets.html
or increase socketAcquisitionWarningTimeout=(millis) in the NodeHttpHandler config.`),Date.now()}return r}resolveDefaultConfig(e){let{requestTimeout:r,connectionTimeout:o,socketTimeout:n,httpAgent:s,httpsAgent:i}=e||{},a=!0,c=50;return{connectionTimeout:o,requestTimeout:r??n,httpAgent:s instanceof L.Agent||typeof s?.destroy=="function"?s:new L.Agent({keepAlive:a,maxSockets:c,...s}),httpsAgent:i instanceof $.Agent||typeof i?.destroy=="function"?i:new $.Agent({keepAlive:a,maxSockets:c,...i}),logger:console}}destroy(){var e,r,o,n;(r=(e=this.config)==null?void 0:e.httpAgent)==null||r.destroy(),(n=(o=this.config)==null?void 0:o.httpsAgent)==null||n.destroy()}async handle(e,{abortSignal:r}={}){return this.config||(this.config=await this.configProvider),new Promise((o,n)=>{let s,i=[],a=u(async l=>{await s,i.forEach(clearTimeout),o(l)},"resolve"),c=u(async l=>{await s,i.forEach(clearTimeout),n(l)},"reject");if(!this.config)throw new Error("Node HTTP request handler config is not resolved");if(r?.aborted){let l=new Error("Request aborted");l.name="AbortError",c(l);return}let f=e.protocol==="https:",b=f?this.config.httpsAgent:this.config.httpAgent;i.push(setTimeout(()=>{this.socketWarningTimestamp=F.checkSocketUsage(b,this.socketWarningTimestamp,this.config.logger)},this.config.socketAcquisitionWarningTimeout??(this.config.requestTimeout??2e3)+(this.config.connectionTimeout??1e3)));let v=(0,Pe.buildQueryString)(e.query||{}),C;if(e.username!=null||e.password!=null){let l=e.username??"",h=e.password??"";C=`${l}:${h}`}let y=e.path;v&&(y+=`?${v}`),e.fragment&&(y+=`#${e.fragment}`);let _=e.hostname??"";_[0]==="["&&_.endsWith("]")?_=e.hostname.slice(1,-1):_=e.hostname;let R={headers:e.headers,host:_,method:e.method,path:y,port:e.port,agent:b,auth:C},g=(f?$.request:L.request)(R,l=>{let h=new He.HttpResponse({statusCode:l.statusCode||-1,reason:l.statusMessage,headers:Re(l.headers),body:l});a({response:h})});if(g.on("error",l=>{Bt.includes(l.code)?c(Object.assign(l,{name:"TimeoutError"})):c(l)}),r){let l=u(()=>{g.destroy();let h=new Error("Request aborted");h.name="AbortError",c(h)},"onAbort");if(typeof r.addEventListener=="function"){let h=r;h.addEventListener("abort",l,{once:!0}),g.once("close",()=>h.removeEventListener("abort",l))}else r.onabort=l}i.push(Qt(g,c,this.config.connectionTimeout)),i.push(Vt(g,c,this.config.requestTimeout));let w=R.agent;typeof w=="object"&&"keepAlive"in w&&i.push(Kt(g,{keepAlive:w.keepAlive,keepAliveMsecs:w.keepAliveMsecs})),s=M(g,e,this.config.requestTimeout).catch(l=>(i.forEach(clearTimeout),n(l)))})}updateHttpClientConfig(e,r){this.config=void 0,this.configProvider=this.configProvider.then(o=>({...o,[e]:r}))}httpHandlerConfigs(){return this.config??{}}};u(Ae,"NodeHttpHandler");var Jt=Ae,Ce=require("http2"),zt=Mt(require("http2")),ke=class{constructor(e){this.sessions=[],this.sessions=e??[]}poll(){if(this.sessions.length>0)return this.sessions.shift()}offerLast(e){this.sessions.push(e)}contains(e){return this.sessions.includes(e)}remove(e){this.sessions=this.sessions.filter(r=>r!==e)}[Symbol.iterator](){return this.sessions[Symbol.iterator]()}destroy(e){for(let r of this.sessions)r===e&&(r.destroyed||r.destroy())}};u(ke,"NodeHttp2ConnectionPool");var Xt=ke,xe=class{constructor(e){if(this.sessionCache=new Map,this.config=e,this.config.maxConcurrency&&this.config.maxConcurrency<=0)throw new RangeError("maxConcurrency must be greater than zero.")}lease(e,r){let o=this.getUrlString(e),n=this.sessionCache.get(o);if(n){let c=n.poll();if(c&&!this.config.disableConcurrency)return c}let s=zt.default.connect(o);this.config.maxConcurrency&&s.settings({maxConcurrentStreams:this.config.maxConcurrency},c=>{if(c)throw new Error("Fail to set maxConcurrentStreams to "+this.config.maxConcurrency+"when creating new session for "+e.destination.toString())}),s.unref();let i=u(()=>{s.destroy(),this.deleteSession(o,s)},"destroySessionCb");s.on("goaway",i),s.on("error",i),s.on("frameError",i),s.on("close",()=>this.deleteSession(o,s)),r.requestTimeout&&s.setTimeout(r.requestTimeout,i);let a=this.sessionCache.get(o)||new Xt;return a.offerLast(s),this.sessionCache.set(o,a),s}deleteSession(e,r){let o=this.sessionCache.get(e);o&&o.contains(r)&&(o.remove(r),this.sessionCache.set(e,o))}release(e,r){var o;let n=this.getUrlString(e);(o=this.sessionCache.get(n))==null||o.offerLast(r)}destroy(){for(let[e,r]of this.sessionCache){for(let o of r)o.destroyed||o.destroy(),r.remove(o);this.sessionCache.delete(e)}}setMaxConcurrentStreams(e){if(this.config.maxConcurrency&&this.config.maxConcurrency<=0)throw new RangeError("maxConcurrentStreams must be greater than zero.");this.config.maxConcurrency=e}setDisableConcurrentStreams(e){this.config.disableConcurrency=e}getUrlString(e){return e.destination.toString()}};u(xe,"NodeHttp2ConnectionManager");var Gt=xe,De=class Ne{constructor(e){this.metadata={handlerProtocol:"h2"},this.connectionManager=new Gt({}),this.configProvider=new Promise((r,o)=>{typeof e=="function"?e().then(n=>{r(n||{})}).catch(o):r(e||{})})}static create(e){return typeof e?.handle=="function"?e:new Ne(e)}destroy(){this.connectionManager.destroy()}async handle(e,{abortSignal:r}={}){this.config||(this.config=await this.configProvider,this.connectionManager.setDisableConcurrentStreams(this.config.disableConcurrentStreams||!1),this.config.maxConcurrentStreams&&this.connectionManager.setMaxConcurrentStreams(this.config.maxConcurrentStreams));let{requestTimeout:o,disableConcurrentStreams:n}=this.config;return new Promise((s,i)=>{var a;let c=!1,f,b=u(async d=>{await f,s(d)},"resolve"),v=u(async d=>{await f,i(d)},"reject");if(r?.aborted){c=!0;let d=new Error("Request aborted");d.name="AbortError",v(d);return}let{hostname:C,method:y,port:_,protocol:R,query:q}=e,g="";if(e.username!=null||e.password!=null){let d=e.username??"",m=e.password??"";g=`${d}:${m}@`}let w=`${R}//${g}${C}${_?`:${_}`:""}`,l={destination:new URL(w)},h=this.connectionManager.lease(l,{requestTimeout:(a=this.config)==null?void 0:a.sessionTimeout,disableConcurrentStreams:n||!1}),T=u(d=>{n&&this.destroySession(h),c=!0,v(d)},"rejectWithDestroy"),B=(0,Pe.buildQueryString)(q||{}),N=e.path;B&&(N+=`?${B}`),e.fragment&&(N+=`#${e.fragment}`);let p=h.request({...e.headers,[Ce.constants.HTTP2_HEADER_PATH]:N,[Ce.constants.HTTP2_HEADER_METHOD]:y});if(h.ref(),p.on("response",d=>{let m=new He.HttpResponse({statusCode:d[":status"]||-1,headers:Re(d),body:p});c=!0,b({response:m}),n&&(h.close(),this.connectionManager.deleteSession(w,h))}),o&&p.setTimeout(o,()=>{p.close();let d=new Error(`Stream timed out because of no activity for ${o} ms`);d.name="TimeoutError",T(d)}),r){let d=u(()=>{p.close();let m=new Error("Request aborted");m.name="AbortError",T(m)},"onAbort");if(typeof r.addEventListener=="function"){let m=r;m.addEventListener("abort",d,{once:!0}),p.once("close",()=>m.removeEventListener("abort",d))}else r.onabort=d}p.on("frameError",(d,m,qe)=>{T(new Error(`Frame type id ${d} in stream id ${qe} has failed with code ${m}.`))}),p.on("error",T),p.on("aborted",()=>{T(new Error(`HTTP/2 stream is abnormally aborted in mid-communication with result code ${p.rstCode}.`))}),p.on("close",()=>{h.unref(),n&&h.destroy(),c||T(new Error("Unexpected error: http2 request did not get a response"))}),f=M(p,e,o)})}updateHttpClientConfig(e,r){this.config=void 0,this.configProvider=this.configProvider.then(o=>({...o,[e]:r}))}httpHandlerConfigs(){return this.config??{}}destroySession(e){e.destroyed||e.destroy()}};u(De,"NodeHttp2Handler");var Zt=De,je=class extends Se.Writable{constructor(){super(...arguments),this.bufferedBytes=[]}_write(e,r,o){this.bufferedBytes.push(e),o()}};u(je,"Collector");var er=je,tr=u(t=>rr(t)?Ue(t):new Promise((e,r)=>{let o=new er;t.pipe(o),t.on("error",n=>{o.end(),r(n)}),o.on("error",r),o.on("finish",function(){let n=new Uint8Array(Buffer.concat(this.bufferedBytes));e(n)})}),"streamCollector"),rr=u(t=>typeof ReadableStream=="function"&&t instanceof ReadableStream,"isReadableStreamInstance");async function Ue(t){let e=[],r=t.getReader(),o=!1,n=0;for(;!o;){let{done:a,value:c}=await r.read();c&&(e.push(c),n+=c.length),o=a}let s=new Uint8Array(n),i=0;for(let a of e)s.set(a,i),i+=a.length;return s}u(Ue,"collectReadableStream")});var ir={};Ye(ir,{handler:()=>nr,invoke:()=>Me});module.exports=ze(ir);var $e=require("@aws-sdk/client-lambda"),Fe=Je(Le()),or=t=>{if(t)return new TextDecoder().decode(Buffer.from(t))},Me=async(t,e,r)=>{let o=new $e.Lambda({requestHandler:new Fe.NodeHttpHandler({socketTimeout:r})}),n={FunctionName:t,InvocationType:e};console.log({invokeRequest:n});let s=0,i=5e3,a;for(;;)try{a=await o.invoke(n);break}catch(f){if(f.name==="AccessDeniedException"&&s<12){s++,await new Promise(b=>{setTimeout(b,i)});continue}throw f}let c={...a,Payload:or(a.Payload)};return console.log({invokeResponse:c}),c};async function nr(t){if(console.log({...t,ResponseURL:"..."}),t.RequestType==="Delete"){console.log("not calling trigger on DELETE");return}if(t.RequestType==="Update"&&t.ResourceProperties.ExecuteOnHandlerChange==="false"){console.log("not calling trigger because ExecuteOnHandlerChange is false");return}let e=t.ResourceProperties.HandlerArn;if(!e)throw new Error('The "HandlerArn" property is required');let r=t.ResourceProperties.InvocationType,o=t.ResourceProperties.Timeout,n=parseInt(o);if(isNaN(n))throw new Error(`The "Timeout" property with value ${o} is not parsable to a number`);let s=await Me(e,r,n);if(s.StatusCode&&s.StatusCode>=400)throw new Error(`Trigger handler failed with status code ${s.StatusCode}`);if(s.FunctionError)throw new Error(sr(s.Payload))}function sr(t){if(!t)return"unknown handler error";console.log(`Error payload: ${t}`);try{let e=JSON.parse(t),r=[e.errorMessage,e.trace].filter(o=>o).join(`
`);return r.length>0?r:t}catch{return t}}0&&(module.exports={handler,invoke});
