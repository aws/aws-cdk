"use strict";var p=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var d=Object.prototype.hasOwnProperty;var m=(e,s)=>{for(var t in s)p(e,t,{get:s[t],enumerable:!0})},b=(e,s,t,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let a of u(s))!d.call(e,a)&&a!==t&&p(e,a,{get:()=>s[a],enumerable:!(o=R(s,a))||o.enumerable});return e};var T=e=>b(p({},"__esModule",{value:!0}),e);var y={};m(y,{isCompleteHandler:()=>C,onEventHandler:()=>g});module.exports=T(y);var c=require("@aws-sdk/client-dynamodb");async function g(e){console.log("Event: %j",{...e,ResponseURL:"..."});let s=new c.DynamoDB({}),t=e.ResourceProperties.TableName,o=e.ResourceProperties.Region,a=e.ResourceProperties.SkipDelete,i;if(e.RequestType==="Create"||e.RequestType==="Delete")i=e.RequestType;else{let l=await s.describeTable({TableName:t});console.log("Describe table: %j",l),i=l.Table?.Replicas?.some(n=>n.RegionName===o)?void 0:"Create"}if(i)if(i==="Delete"&&a)console.log("Skipping deleting Table");else{let l=await s.updateTable({TableName:t,ReplicaUpdates:[{[i]:{RegionName:o}}]});console.log("Update table: %j",l)}else console.log("Skipping updating Table, as a replica in '%s' already exists",o);return e.RequestType==="Create"||e.RequestType==="Update"?{PhysicalResourceId:`${t}-${o}`}:{}}async function C(e){console.log("Event: %j",{...e,ResponseURL:"..."});let t=await new c.DynamoDB({}).describeTable({TableName:e.ResourceProperties.TableName});console.log("Describe table: %j",t);let o=t.Table?.TableStatus==="ACTIVE",i=(t.Table?.Replicas??[]).find(n=>n.RegionName===e.ResourceProperties.Region),l=i?.ReplicaStatus==="ACTIVE",r=e.ResourceProperties.SkipReplicationCompletedWait==="true";switch(e.RequestType){case"Create":case"Update":return{IsComplete:o&&(l||r)};case"Delete":return e.ResourceProperties.SkipDelete==="true"?(console.log("Skipping deletion check since SkipDelete is true"),{IsComplete:!0}):{IsComplete:o&&i===void 0}}}0&&(module.exports={isCompleteHandler,onEventHandler});
