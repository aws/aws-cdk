"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("@aws-cdk/assertions");
const events = require("@aws-cdk/aws-events");
const iam = require("@aws-cdk/aws-iam");
const core_1 = require("@aws-cdk/core");
const targets = require("../../lib");
describe('with basic auth connection', () => {
    let stack;
    let connection;
    let destination;
    let rule;
    beforeEach(() => {
        stack = new core_1.Stack();
        connection = new events.Connection(stack, 'Connection', {
            authorization: events.Authorization.basic('username', core_1.SecretValue.unsafePlainText('password')),
            description: 'ConnectionDescription',
            connectionName: 'testConnection',
        });
        destination = new events.ApiDestination(stack, 'Destination', {
            connection,
            endpoint: 'https://endpoint.com',
        });
        rule = new events.Rule(stack, 'Rule', {
            schedule: events.Schedule.rate(core_1.Duration.minutes(1)),
        });
    });
    test('use api destination as an eventrule target', () => {
        // WHEN
        rule.addTarget(new targets.ApiDestination(destination));
        // THEN
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::Events::Rule', {
            ScheduleExpression: 'rate(1 minute)',
            State: 'ENABLED',
            Targets: [
                {
                    Arn: { 'Fn::GetAtt': ['DestinationApiDestinationA879FAE5', 'Arn'] },
                    Id: 'Target0',
                    RoleArn: { 'Fn::GetAtt': ['DestinationEventsRole7DA63556', 'Arn'] },
                },
            ],
        });
    });
    test('with an explicit event role', () => {
        // WHEN
        const eventRole = new iam.Role(stack, 'Role', {
            assumedBy: new iam.ServicePrincipal('events.amazonaws.com'),
        });
        rule.addTarget(new targets.ApiDestination(destination, { eventRole }));
        // THEN
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::Events::Rule', {
            Targets: [
                {
                    RoleArn: { 'Fn::GetAtt': ['Role1ABCC5F0', 'Arn'] },
                    Id: 'Target0',
                },
            ],
        });
    });
    test('with header parameter', () => {
        // WHEN
        rule.addTarget(new targets.ApiDestination(destination, {
            headerParameters: { headerName: 'headerValue' },
        }));
        // THEN
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::Events::Rule', {
            Targets: [
                {
                    Arn: { 'Fn::GetAtt': ['DestinationApiDestinationA879FAE5', 'Arn'] },
                    Id: 'Target0',
                    RoleArn: { 'Fn::GetAtt': ['DestinationEventsRole7DA63556', 'Arn'] },
                    HttpParameters: { HeaderParameters: { headerName: 'headerValue' } },
                },
            ],
        });
    });
    test('with query parameter', () => {
        // WHEN
        rule.addTarget(new targets.ApiDestination(destination, {
            queryStringParameters: { queryName: 'queryValue' },
        }));
        // THEN
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::Events::Rule', {
            Targets: [
                {
                    Arn: { 'Fn::GetAtt': ['DestinationApiDestinationA879FAE5', 'Arn'] },
                    Id: 'Target0',
                    RoleArn: { 'Fn::GetAtt': ['DestinationEventsRole7DA63556', 'Arn'] },
                    HttpParameters: { QueryStringParameters: { queryName: 'queryValue' } },
                },
            ],
        });
    });
    test('with path parameter', () => {
        // WHEN
        rule.addTarget(new targets.ApiDestination(destination, {
            pathParameterValues: ['pathValue'],
        }));
        // THEN
        const template = assertions_1.Template.fromStack(stack);
        template.hasResourceProperties('AWS::Events::Rule', {
            Targets: [
                {
                    Arn: { 'Fn::GetAtt': ['DestinationApiDestinationA879FAE5', 'Arn'] },
                    Id: 'Target0',
                    RoleArn: { 'Fn::GetAtt': ['DestinationEventsRole7DA63556', 'Arn'] },
                    HttpParameters: { PathParameterValues: ['pathValue'] },
                },
            ],
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLWRlc3RpbmF0aW9uLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhcGktZGVzdGluYXRpb24udGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG9EQUErQztBQUMvQyw4Q0FBOEM7QUFDOUMsd0NBQXdDO0FBQ3hDLHdDQUE2RDtBQUM3RCxxQ0FBcUM7QUFHckMsUUFBUSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRTtJQUMxQyxJQUFJLEtBQVksQ0FBQztJQUNqQixJQUFJLFVBQTZCLENBQUM7SUFDbEMsSUFBSSxXQUFrQyxDQUFDO0lBQ3ZDLElBQUksSUFBaUIsQ0FBQztJQUV0QixVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsS0FBSyxHQUFHLElBQUksWUFBSyxFQUFFLENBQUM7UUFDcEIsVUFBVSxHQUFHLElBQUksTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsWUFBWSxFQUFFO1lBQ3RELGFBQWEsRUFBRSxNQUFNLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsa0JBQVcsQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDOUYsV0FBVyxFQUFFLHVCQUF1QjtZQUNwQyxjQUFjLEVBQUUsZ0JBQWdCO1NBQ2pDLENBQUMsQ0FBQztRQUVILFdBQVcsR0FBRyxJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLGFBQWEsRUFBRTtZQUM1RCxVQUFVO1lBQ1YsUUFBUSxFQUFFLHNCQUFzQjtTQUNqQyxDQUFDLENBQUM7UUFFSCxJQUFJLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUU7WUFDcEMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGVBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDcEQsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsNENBQTRDLEVB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eyBUZW1wbGF0ZSB9IGZyb20gJ0Bhd3MtY2RrL2Fzc2VydGlvbnMnO1xuaW1wb3J0ICogYXMgZXZlbnRzIGZyb20gJ0Bhd3MtY2RrL2F3cy1ldmVudHMnO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ0Bhd3MtY2RrL2F3cy1pYW0nO1xuaW1wb3J0IHsgRHVyYXRpb24sIFNlY3JldFZhbHVlLCBTdGFjayB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0ICogYXMgdGFyZ2V0cyBmcm9tICcuLi8uLi9saWInO1xuXG5cbmRlc2NyaWJlKCd3aXRoIGJhc2ljIGF1dGggY29ubmVjdGlvbicsICgpID0+IHtcbiAgbGV0IHN0YWNrOiBTdGFjaztcbiAgbGV0IGNvbm5lY3Rpb246IGV2ZW50cy5Db25uZWN0aW9uO1xuICBsZXQgZGVzdGluYXRpb246IGV2ZW50cy5BcGlEZXN0aW5hdGlvbjtcbiAgbGV0IHJ1bGU6IGV2ZW50cy5SdWxlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgY29ubmVjdGlvbiA9IG5ldyBldmVudHMuQ29ubmVjdGlvbihzdGFjaywgJ0Nvbm5lY3Rpb24nLCB7XG4gICAgICBhdXRob3JpemF0aW9uOiBldmVudHMuQXV0aG9yaXphdGlvbi5iYXNpYygndXNlcm5hbWUnLCBTZWNyZXRWYWx1ZS51bnNhZmVQbGFpblRleHQoJ3Bhc3N3b3JkJykpLFxuICAgICAgZGVzY3JpcHRpb246ICdDb25uZWN0aW9uRGVzY3JpcHRpb24nLFxuICAgICAgY29ubmVjdGlvbk5hbWU6ICd0ZXN0Q29ubmVjdGlvbicsXG4gICAgfSk7XG5cbiAgICBkZXN0aW5hdGlvbiA9IG5ldyBldmVudHMuQXBpRGVzdGluYXRpb24oc3RhY2ssICdEZXN0aW5hdGlvbicsIHtcbiAgICAgIGNvbm5lY3Rpb24sXG4gICAgICBlbmRwb2ludDogJ2h0dHBzOi8vZW5kcG9pbnQuY29tJyxcbiAgICB9KTtcblxuICAgIHJ1bGUgPSBuZXcgZXZlbnRzLlJ1bGUoc3RhY2ssICdSdWxlJywge1xuICAgICAgc2NoZWR1bGU6IGV2ZW50cy5TY2hlZHVsZS5yYXRlKER1cmF0aW9uLm1pbnV0ZXMoMSkpLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCd1c2UgYXBpIGRlc3RpbmF0aW9uIGFzIGFuIGV2ZW50cnVsZSB0YXJnZXQnLCAoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIHJ1bGUuYWRkVGFyZ2V0KG5ldyB0YXJnZXRzLkFwaURlc3RpbmF0aW9uKGRlc3RpbmF0aW9uKSk7XG5cbiAgICAvLyBUSEVOXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpFdmVudHM6OlJ1bGUnLCB7XG4gICAgICBTY2hlZHVsZUV4cHJlc3Npb246ICdyYXRlKDEgbWludXRlKScsXG4gICAgICBTdGF0ZTogJ0VOQUJMRUQnLFxuICAgICAgVGFyZ2V0czogW1xuICAgICAgICB7XG4gICAgICAgICAgQXJuOiB7ICdGbjo6R2V0QXR0JzogWydEZXN0aW5hdGlvbkFwaURlc3RpbmF0aW9uQTg3OUZBRTUnLCAnQXJuJ10gfSxcbiAgICAgICAgICBJZDogJ1RhcmdldDAnLFxuICAgICAgICAgIFJvbGVBcm46IHsgJ0ZuOjpHZXRBdHQnOiBbJ0Rlc3RpbmF0aW9uRXZlbnRzUm9sZTdEQTYzNTU2JywgJ0FybiddIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCd3aXRoIGFuIGV4cGxpY2l0IGV2ZW50IHJvbGUnLCAoKSA9PiB7XG4gICAgLy8gV0hFTlxuICAgIGNvbnN0IGV2ZW50Um9sZSA9IG5ldyBpYW0uUm9sZShzdGFjaywgJ1JvbGUnLCB7XG4gICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnZXZlbnRzLmFtYXpvbmF3cy5jb20nKSxcbiAgICB9KTtcbiAgICBydWxlLmFkZFRhcmdldChuZXcgdGFyZ2V0cy5BcGlEZXN0aW5hdGlvbihkZXN0aW5hdGlvbiwgeyBldmVudFJvbGUgfSkpO1xuXG4gICAgLy8gVEhFTlxuICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcbiAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6RXZlbnRzOjpSdWxlJywge1xuICAgICAgVGFyZ2V0czogW1xuICAgICAgICB7XG4gICAgICAgICAgUm9sZUFybjogeyAnRm46OkdldEF0dCc6IFsnUm9sZTFBQkNDNUYwJywgJ0FybiddIH0sXG4gICAgICAgICAgSWQ6ICdUYXJnZXQwJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3dpdGggaGVhZGVyIHBhcmFtZXRlcicsICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgcnVsZS5hZGRUYXJnZXQobmV3IHRhcmdldHMuQXBpRGVzdGluYXRpb24oZGVzdGluYXRpb24sIHtcbiAgICAgIGhlYWRlclBhcmFtZXRlcnM6IHsgaGVhZGVyTmFtZTogJ2hlYWRlclZhbHVlJyB9LFxuICAgIH0pKTtcblxuICAgIC8vIFRIRU5cbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkV2ZW50czo6UnVsZScsIHtcbiAgICAgIFRhcmdldHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIEFybjogeyAnRm46OkdldEF0dCc6IFsnRGVzdGluYXRpb25BcGlEZXN0aW5hdGlvbkE4NzlGQUU1JywgJ0FybiddIH0sXG4gICAgICAgICAgSWQ6ICdUYXJnZXQwJyxcbiAgICAgICAgICBSb2xlQXJuOiB7ICdGbjo6R2V0QXR0JzogWydEZXN0aW5hdGlvbkV2ZW50c1JvbGU3REE2MzU1NicsICdBcm4nXSB9LFxuICAgICAgICAgIEh0dHBQYXJhbWV0ZXJzOiB7IEhlYWRlclBhcmFtZXRlcnM6IHsgaGVhZGVyTmFtZTogJ2hlYWRlclZhbHVlJyB9IH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCd3aXRoIHF1ZXJ5IHBhcmFtZXRlcicsICgpID0+IHtcbiAgICAvLyBXSEVOXG4gICAgcnVsZS5hZGRUYXJnZXQobmV3IHRhcmdldHMuQXBpRGVzdGluYXRpb24oZGVzdGluYXRpb24sIHtcbiAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogeyBxdWVyeU5hbWU6ICdxdWVyeVZhbHVlJyB9LFxuICAgIH0pKTtcblxuICAgIC8vIFRIRU5cbiAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XG4gICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkV2ZW50czo6UnVsZScsIHtcbiAgICAgIFRhcmdldHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIEFybjogeyAnRm46OkdldEF0dCc6IFsnRGVzdGluYXRpb25BcGlEZXN0aW5hdGlvbkE4NzlGQUU1JywgJ0FybiddIH0sXG4gICAgICAgICAgSWQ6ICdUYXJnZXQwJyxcbiAgICAgICAgICBSb2xlQXJuOiB7ICdGbjo6R2V0QXR0JzogWydEZXN0aW5hdGlvbkV2ZW50c1JvbGU3REE2MzU1NicsICdBcm4nXSB9LFxuICAgICAgICAgIEh0dHBQYXJhbWV0ZXJzOiB7IFF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogeyBxdWVyeU5hbWU6ICdxdWVyeVZhbHVlJyB9IH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCd3aXRoIHBhdGggcGFyYW1ldGVyJywgKCkgPT4ge1xuICAgIC8vIFdIRU5cbiAgICBydWxlLmFkZFRhcmdldChuZXcgdGFyZ2V0cy5BcGlEZXN0aW5hdGlvbihkZXN0aW5hdGlvbiwge1xuICAgICAgcGF0aFBhcmFtZXRlclZhbHVlczogWydwYXRoVmFsdWUnXSxcbiAgICB9KSk7XG5cbiAgICAvLyBUSEVOXG4gICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpFdmVudHM6OlJ1bGUnLCB7XG4gICAgICBUYXJnZXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBBcm46IHsgJ0ZuOjpHZXRBdHQnOiBbJ0Rlc3RpbmF0aW9uQXBpRGVzdGluYXRpb25BODc5RkFFNScsICdBcm4nXSB9LFxuICAgICAgICAgIElkOiAnVGFyZ2V0MCcsXG4gICAgICAgICAgUm9sZUFybjogeyAnRm46OkdldEF0dCc6IFsnRGVzdGluYXRpb25FdmVudHNSb2xlN0RBNjM1NTYnLCAnQXJuJ10gfSxcbiAgICAgICAgICBIdHRwUGFyYW1ldGVyczogeyBQYXRoUGFyYW1ldGVyVmFsdWVzOiBbJ3BhdGhWYWx1ZSddIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19