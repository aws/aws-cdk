"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("@aws-cdk/assertions");
const core_1 = require("@aws-cdk/core");
const ec2 = require("../lib");
let app;
let stack;
beforeEach(() => {
    app = new core_1.App();
    stack = new core_1.Stack(app, 'Stack', {
        env: { account: '1234', region: 'testregion' },
    });
});
test('can make and use a Linux image', () => {
    // WHEN
    const image = new ec2.GenericLinuxImage({
        testregion: 'ami-1234',
    });
    // THEN
    const details = image.getImage(stack);
    expect(details.imageId).toEqual('ami-1234');
    expect(details.osType).toEqual(ec2.OperatingSystemType.LINUX);
});
test('can make and use a Linux image in agnostic stack', () => {
    // WHEN
    app = new core_1.App();
    stack = new core_1.Stack(app, 'Stack');
    const image = new ec2.GenericLinuxImage({
        testregion: 'ami-1234',
    });
    // THEN
    const details = image.getImage(stack);
    const expected = {
        Mappings: {
            AmiMap: {
                testregion: {
                    ami: 'ami-1234',
                },
            },
        },
    };
    assertions_1.Template.fromStack(stack).templateMatches(expected);
    expect(stack.resolve(details.imageId)).toEqual({ 'Fn::FindInMap': ['AmiMap', { Ref: 'AWS::Region' }, 'ami'] });
    expect(details.osType).toEqual(ec2.OperatingSystemType.LINUX);
});
test('can make and use a Windows image', () => {
    // WHEN
    const image = new ec2.GenericWindowsImage({
        testregion: 'ami-1234',
    });
    // THEN
    const details = image.getImage(stack);
    expect(details.imageId).toEqual('ami-1234');
    expect(details.osType).toEqual(ec2.OperatingSystemType.WINDOWS);
});
test('can make and use a Windows image in agnostic stack', () => {
    // WHEN
    app = new core_1.App();
    stack = new core_1.Stack(app, 'Stack');
    const image = new ec2.GenericWindowsImage({
        testregion: 'ami-1234',
    });
    // THEN
    const details = image.getImage(stack);
    const expected = {
        Mappings: {
            AmiMap: {
                testregion: {
                    ami: 'ami-1234',
                },
            },
        },
    };
    assertions_1.Template.fromStack(stack).templateMatches(expected);
    expect(stack.resolve(details.imageId)).toEqual({ 'Fn::FindInMap': ['AmiMap', { Ref: 'AWS::Region' }, 'ami'] });
    expect(details.osType).toEqual(ec2.OperatingSystemType.WINDOWS);
});
test('can make and use a Generic SSM image', () => {
    // WHEN
    const image = new ec2.GenericSSMParameterImage('testParam', ec2.OperatingSystemType.LINUX);
    // THEN
    const details = image.getImage(stack);
    expect(details.imageId).toContain('TOKEN');
    expect(details.osType).toEqual(ec2.OperatingSystemType.LINUX);
});
test('WindowsImage retains userdata if given', () => {
    // WHEN
    const ud = ec2.UserData.forWindows();
    const image = new ec2.GenericWindowsImage({
        testregion: 'ami-1234',
    }, {
        userData: ud,
    });
    // THEN
    const details = image.getImage(stack);
    expect(details.userData).toEqual(ud);
});
test('WindowsImage creates UserData if not given', () => {
    // WHEN
    const image = new ec2.GenericWindowsImage({
        testregion: 'ami-1234',
    });
    // THEN
    const details = image.getImage(stack);
    expect(isWindowsUserData(details.userData)).toBeTruthy();
});
test('LookupMachineImage default search', () => {
    // GIVEN
    // WHEN
    new ec2.LookupMachineImage({ name: 'bla*', owners: ['amazon'] }).getImage(stack);
    // THEN
    const missing = app.synth().manifest.missing || [];
    expect(missing).toEqual([
        {
            key: 'ami:account=1234:filters.image-type.0=machine:filters.name.0=bla*:filters.state.0=available:owners.0=amazon:region=testregion',
            props: {
                account: '1234',
                region: 'testregion',
                lookupRoleArn: 'arn:${AWS::Partition}:iam::1234:role/cdk-hnb659fds-lookup-role-1234-testregion',
                owners: ['amazon'],
                filters: {
                    'name': ['bla*'],
                    'state': ['available'],
                    'image-type': ['machine'],
                },
            },
            provider: 'ami',
        },
    ]);
});
test('LookupMachineImage creates correct type of UserData', () => {
    // WHEN
    const linuxDetails = new ec2.LookupMachineImage({ name: 'bla*', owners: ['amazon'] }).getImage(stack);
    const windowsDetails = new ec2.LookupMachineImage({ name: 'bla*', owners: ['amazon'], windows: true }).getImage(stack);
    // THEN
    expect(isWindowsUserData(windowsDetails.userData)).toBeTruthy();
    expect(isLinuxUserData(linuxDetails.userData)).toBeTruthy();
});
test('cached lookups of Amazon Linux', () => {
    // WHEN
    const ami = ec2.MachineImage.latestAmazonLinux({ cachedInContext: true }).getImage(stack).imageId;
    // THEN
    expect(ami).toEqual('dummy-value-for-/aws/service/ami-amazon-linux-latest/amzn-ami-hvm-x86_64-gp2');
    expect(app.synth().manifest.missing).toEqual([
        {
            key: 'ssm:account=1234:parameterName=/aws/service/ami-amazon-linux-latest/amzn-ami-hvm-x86_64-gp2:region=testregion',
            props: {
                account: '1234',
                lookupRoleArn: 'arn:${AWS::Partition}:iam::1234:role/cdk-hnb659fds-lookup-role-1234-testregion',
                region: 'testregion',
                parameterName: '/aws/service/ami-amazon-linux-latest/amzn-ami-hvm-x86_64-gp2',
            },
            provider: 'ssm',
        },
    ]);
});
test('cached lookups of Amazon Linux 2', () => {
    // WHEN
    const ami = ec2.MachineImage.latestAmazonLinux({
        cachedInContext: true,
        generation: ec2.AmazonLinuxGeneration.AMAZON_LINUX_2,
    }).getImage(stack).imageId;
    // THEN
    expect(ami).toEqual('dummy-value-for-/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2');
    expect(app.synth().manifest.missing).toEqual([
        {
            key: 'ssm:account=1234:parameterName=/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2:region=testregion',
            props: {
                account: '1234',
                lookupRoleArn: 'arn:${AWS::Partition}:iam::1234:role/cdk-hnb659fds-lookup-role-1234-testregion',
                region: 'testregion',
                parameterName: '/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2',
            },
            provider: 'ssm',
        },
    ]);
});
test('cached lookups of Amazon Linux 2 with kernel 5.x', () => {
    // WHEN
    const ami = ec2.MachineImage.latestAmazonLinux({
        cachedInContext: true,
        generation: ec2.AmazonLinuxGeneration.AMAZON_LINUX_2,
        kernel: ec2.AmazonLinuxKernel.KERNEL5_X,
    }).getImage(stack).imageId;
    // THEN
    expect(ami).toEqual('dummy-value-for-/aws/service/ami-amazon-linux-latest/amzn2-ami-kernel-5.10-hvm-x86_64-gp2');
    expect(app.synth().manifest.missing).toEqual([
        {
            key: 'ssm:account=1234:parameterName=/aws/service/ami-amazon-linux-latest/amzn2-ami-kernel-5.10-hvm-x86_64-gp2:region=testregion',
            props: {
                account: '1234',
                lookupRoleArn: 'arn:${AWS::Partition}:iam::1234:role/cdk-hnb659fds-lookup-role-1234-testregion',
                region: 'testregion',
                parameterName: '/aws/service/ami-amazon-linux-latest/amzn2-ami-kernel-5.10-hvm-x86_64-gp2',
            },
            provider: 'ssm',
        },
    ]);
});
test('throw error if storage param is set for Amazon Linux 2022', () => {
    expect(() => {
        ec2.MachineImage.latestAmazonLinux({
            cachedInContext: true,
            generation: ec2.AmazonLinuxGeneration.AMAZON_LINUX_2022,
            storage: ec2.AmazonLinuxStorage.GENERAL_PURPOSE,
        }).getImage(stack).imageId;
    }).toThrow(/Storage parameter does not exist in smm parameter name for Amazon Linux 2022./);
});
test('throw error if virtualization param is set for Amazon Linux 2022', () => {
    expect(() => {
        ec2.MachineImage.latestAmazonLinux({
            cachedInContext: true,
            generation: ec2.AmazonLinuxGeneration.AMAZON_LINUX_2022,
            virtualization: ec2.AmazonLinuxVirt.HVM,
        }).getImage(stack).imageId;
    }).toThrow(/Virtualization parameter does not exist in smm parameter name for Amazon Linux 2022./);
});
test('cached lookups of Amazon Linux 2022 with kernel 5.x', () => {
    // WHEN
    const ami = ec2.MachineImage.latestAmazonLinux({
        cachedInContext: true,
        generation: ec2.AmazonLinuxGeneration.AMAZON_LINUX_2022,
    }).getImage(stack).imageId;
    // THEN
    expect(ami).toEqual('dummy-value-for-/aws/service/ami-amazon-linux-latest/al2022-ami-kernel-5.10-x86_64');
    expect(app.synth().manifest.missing).toEqual([
        {
            key: 'ssm:account=1234:parameterName=/aws/service/ami-amazon-linux-latest/al2022-ami-kernel-5.10-x86_64:region=testregion',
            props: {
                account: '1234',
                lookupRoleArn: 'arn:${AWS::Partition}:iam::1234:role/cdk-hnb659fds-lookup-role-1234-testregion',
                region: 'testregion',
                parameterName: '/aws/service/ami-amazon-linux-latest/al2022-ami-kernel-5.10-x86_64',
            },
            provider: 'ssm',
        },
    ]);
});
function isWindowsUserData(ud) {
    return ud.render().indexOf('powershell') > -1;
}
function isLinuxUserData(ud) {
    return ud.render().indexOf('bash') > -1;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFjaGluZS1pbWFnZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFjaGluZS1pbWFnZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsb0RBQStDO0FBQy9DLHdDQUEyQztBQUMzQyw4QkFBOEI7QUFFOUIsSUFBSSxHQUFRLENBQUM7QUFDYixJQUFJLEtBQVksQ0FBQztBQUVqQixVQUFVLENBQUMsR0FBRyxFQUFFO0lBQ2QsR0FBRyxHQUFHLElBQUksVUFBRyxFQUFFLENBQUM7SUFDaEIsS0FBSyxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUU7UUFDOUIsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFO0tBQy9DLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLGdDQUFnQyxFQUFFLEdBQUcsRUFBRTtJQUMxQyxPQUFPO0lBQ1AsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsaUJBQWlCLENBQUM7UUFDdEMsVUFBVSxFQUFFLFVBQVU7S0FDdkIsQ0FBQyxDQUFDO0lBRUgsT0FBTztJQUNQLE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDNUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2hFLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLGtEQUFrRCxFQUFFLEdBQUcsRUFBRTtJQUM1RCxPQUFPO0lBQ1AsR0FBRyxHQUFHLElBQUksVUFBRyxFQUFFLENBQUM7SUFDaEIsS0FBSyxHQUFHLElBQUksWUFBSyxDQUFDLEdBQUcs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SUFDL0QsT0FBTztJQUNQLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxZQUFZLENBQUMsaUJBQWlCLENBQUM7UUFDN0MsZUFBZSxFQUFFLElBQUk7UUFDckIsVUFBVSxFQUFFLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxpQkFBaUI7S0FDeEQsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUM7SUFFM0IsT0FBTztJQUNQLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsb0ZBQW9GLENBQUMsQ0FBQztJQUMxRyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDM0M7WUFDRSxHQUFHLEVBQUUscUhBQXFIO1lBQzFILEtBQUssRUFBRTtnQkFDTCxPQUFPLEVBQUUsTUFBTTtnQkFDZixhQUFhLEVBQUUsZ0ZBQWdGO2dCQUMvRixNQUFNLEVBQUUsWUFBWTtnQkFDcEIsYUFBYSxFQUFFLG9FQUFvRTthQUNwRjtZQUNELFFBQVEsRUFBRSxLQUFLO1NBQ2hCO0tBQ0YsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxTQUFTLGlCQUFpQixDQUFDLEVBQWdCO0lBQ3pDLE9BQU8sRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUNoRCxDQUFDO0FBRUQsU0FBUyxlQUFlLENBQUMsRUFBZ0I7SUFDdkMsT0FBTyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQzFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gJ0Bhd3MtY2RrL2Fzc2VydGlvbnMnO1xuaW1wb3J0IHsgQXBwLCBTdGFjayB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJy4uL2xpYic7XG5cbmxldCBhcHA6IEFwcDtcbmxldCBzdGFjazogU3RhY2s7XG5cbmJlZm9yZUVhY2goKCkgPT4ge1xuICBhcHAgPSBuZXcgQXBwKCk7XG4gIHN0YWNrID0gbmV3IFN0YWNrKGFwcCwgJ1N0YWNrJywge1xuICAgIGVudjogeyBhY2NvdW50OiAnMTIzNCcsIHJlZ2lvbjogJ3Rlc3RyZWdpb24nIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2NhbiBtYWtlIGFuZCB1c2UgYSBMaW51eCBpbWFnZScsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBpbWFnZSA9IG5ldyBlYzIuR2VuZXJpY0xpbnV4SW1hZ2Uoe1xuICAgIHRlc3RyZWdpb246ICdhbWktMTIzNCcsXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgY29uc3QgZGV0YWlscyA9IGltYWdlLmdldEltYWdlKHN0YWNrKTtcbiAgZXhwZWN0KGRldGFpbHMuaW1hZ2VJZCkudG9FcXVhbCgnYW1pLTEyMzQnKTtcbiAgZXhwZWN0KGRldGFpbHMub3NUeXBlKS50b0VxdWFsKGVjMi5PcGVyYXRpbmdTeXN0ZW1UeXBlLkxJTlVYKTtcbn0pO1xuXG50ZXN0KCdjYW4gbWFrZSBhbmQgdXNlIGEgTGludXggaW1hZ2UgaW4gYWdub3N0aWMgc3RhY2snLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgYXBwID0gbmV3IEFwcCgpO1xuICBzdGFjayA9IG5ldyBTdGFjayhhcHAsICdTdGFjaycpO1xuICBjb25zdCBpbWFnZSA9IG5ldyBlYzIuR2VuZXJpY0xpbnV4SW1hZ2Uoe1xuICAgIHRlc3RyZWdpb246ICdhbWktMTIzNCcsXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgY29uc3QgZGV0YWlscyA9IGltYWdlLmdldEltYWdlKHN0YWNrKTtcbiAgY29uc3QgZXhwZWN0ZWQgPSB7XG4gICAgTWFwcGluZ3M6IHtcbiAgICAgIEFtaU1hcDoge1xuICAgICAgICB0ZXN0cmVnaW9uOiB7XG4gICAgICAgICAgYW1pOiAnYW1pLTEyMzQnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKGV4cGVjdGVkKTtcbiAgZXhwZWN0KHN0YWNrLnJlc29sdmUoZGV0YWlscy5pbWFnZUlkKSkudG9FcXVhbCh7ICdGbjo6RmluZEluTWFwJzogWydBbWlNYXAnLCB7IFJlZjogJ0FXUzo6UmVnaW9uJyB9LCAnYW1pJ10gfSk7XG4gIGV4cGVjdChkZXRhaWxzLm9zVHlwZSkudG9FcXVhbChlYzIuT3BlcmF0aW5nU3lzdGVtVHlwZS5MSU5VWCk7XG59KTtcblxudGVzdCgnY2FuIG1ha2UgYW5kIHVzZSBhIFdpbmRvd3MgaW1hZ2UnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgaW1hZ2UgPSBuZXcgZWMyLkdlbmVyaWNXaW5kb3dzSW1hZ2Uoe1xuICAgIHRlc3RyZWdpb246ICdhbWktMTIzNCcsXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgY29uc3QgZGV0YWlscyA9IGltYWdlLmdldEltYWdlKHN0YWNrKTtcbiAgZXhwZWN0KGRldGFpbHMuaW1hZ2VJZCkudG9FcXVhbCgnYW1pLTEyMzQnKTtcbiAgZXhwZWN0KGRldGFpbHMub3NUeXBlKS50b0VxdWFsKGVjMi5PcGVyYXRpbmdTeXN0ZW1UeXBlLldJTkRPV1MpO1xufSk7XG5cbnRlc3QoJ2NhbiBtYWtlIGFuZCB1c2UgYSBXaW5kb3dzIGltYWdlIGluIGFnbm9zdGljIHN0YWNrJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGFwcCA9IG5ldyBBcHAoKTtcbiAgc3RhY2sgPSBuZXcgU3RhY2soYXBwLCAnU3RhY2snKTtcbiAgY29uc3QgaW1hZ2UgPSBuZXcgZWMyLkdlbmVyaWNXaW5kb3dzSW1hZ2Uoe1xuICAgIHRlc3RyZWdpb246ICdhbWktMTIzNCcsXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgY29uc3QgZGV0YWlscyA9IGltYWdlLmdldEltYWdlKHN0YWNrKTtcbiAgY29uc3QgZXhwZWN0ZWQgPSB7XG4gICAgTWFwcGluZ3M6IHtcbiAgICAgIEFtaU1hcDoge1xuICAgICAgICB0ZXN0cmVnaW9uOiB7XG4gICAgICAgICAgYW1pOiAnYW1pLTEyMzQnLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykudGVtcGxhdGVNYXRjaGVzKGV4cGVjdGVkKTtcbiAgZXhwZWN0KHN0YWNrLnJlc29sdmUoZGV0YWlscy5pbWFnZUlkKSkudG9FcXVhbCh7ICdGbjo6RmluZEluTWFwJzogWydBbWlNYXAnLCB7IFJlZjogJ0FXUzo6UmVnaW9uJyB9LCAnYW1pJ10gfSk7XG4gIGV4cGVjdChkZXRhaWxzLm9zVHlwZSkudG9FcXVhbChlYzIuT3BlcmF0aW5nU3lzdGVtVHlwZS5XSU5ET1dTKTtcbn0pO1xuXG50ZXN0KCdjYW4gbWFrZSBhbmQgdXNlIGEgR2VuZXJpYyBTU00gaW1hZ2UnLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgaW1hZ2UgPSBuZXcgZWMyLkdlbmVyaWNTU01QYXJhbWV0ZXJJbWFnZSgndGVzdFBhcmFtJywgZWMyLk9wZXJhdGluZ1N5c3RlbVR5cGUuTElOVVgpO1xuXG4gIC8vIFRIRU5cbiAgY29uc3QgZGV0YWlscyA9IGltYWdlLmdldEltYWdlKHN0YWNrKTtcbiAgZXhwZWN0KGRldGFpbHMuaW1hZ2VJZCkudG9Db250YWluKCdUT0tFTicpO1xuICBleHBlY3QoZGV0YWlscy5vc1R5cGUpLnRvRXF1YWwoZWMyLk9wZXJhdGluZ1N5c3RlbVR5cGUuTElOVVgpO1xufSk7XG5cbnRlc3QoJ1dpbmRvd3NJbWFnZSByZXRhaW5zIHVzZXJkYXRhIGlmIGdpdmVuJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IHVkID0gZWMyLlVzZXJEYXRhLmZvcldpbmRvd3MoKTtcblxuICBjb25zdCBpbWFnZSA9IG5ldyBlYzIuR2VuZXJpY1dpbmRvd3NJbWFnZSh7XG4gICAgdGVzdHJlZ2lvbjogJ2FtaS0xMjM0JyxcbiAgfSwge1xuICAgIHVzZXJEYXRhOiB1ZCxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBjb25zdCBkZXRhaWxzID0gaW1hZ2UuZ2V0SW1hZ2Uoc3RhY2spO1xuICBleHBlY3QoZGV0YWlscy51c2VyRGF0YSkudG9FcXVhbCh1ZCk7XG59KTtcblxudGVzdCgnV2luZG93c0ltYWdlIGNyZWF0ZXMgVXNlckRhdGEgaWYgbm90IGdpdmVuJywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGltYWdlID0gbmV3IGVjMi5HZW5lcmljV2luZG93c0ltYWdlKHtcbiAgICB0ZXN0cmVnaW9uOiAnYW1pLTEyMzQnLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIGNvbnN0IGRldGFpbHMgPSBpbWFnZS5nZXRJbWFnZShzdGFjayk7XG4gIGV4cGVjdChpc1dpbmRvd3NVc2VyRGF0YShkZXRhaWxzLnVzZXJEYXRhKSkudG9CZVRydXRoeSgpO1xufSk7XG5cbnRlc3QoJ0xvb2t1cE1hY2hpbmVJbWFnZSBkZWZhdWx0IHNlYXJjaCcsICgpID0+IHtcbiAgLy8gR0lWRU5cblxuICAvLyBXSEVOXG4gIG5ldyBlYzIuTG9va3VwTWFjaGluZUltYWdlKHsgbmFtZTogJ2JsYSonLCBvd25lcnM6IFsnYW1hem9uJ10gfSkuZ2V0SW1hZ2Uoc3RhY2spO1xuXG4gIC8vIFRIRU5cbiAgY29uc3QgbWlzc2luZyA9IGFwcC5zeW50aCgpLm1hbmlmZXN0Lm1pc3NpbmcgfHwgW107XG4gIGV4cGVjdChtaXNzaW5nKS50b0VxdWFsKFtcbiAgICB7XG4gICAgICBrZXk6ICdhbWk6YWNjb3VudD0xMjM0OmZpbHRlcnMuaW1hZ2UtdHlwZS4wPW1hY2hpbmU6ZmlsdGVycy5uYW1lLjA9YmxhKjpmaWx0ZXJzLnN0YXRlLjA9YXZhaWxhYmxlOm93bmVycy4wPWFtYXpvbjpyZWdpb249dGVzdHJlZ2lvbicsXG4gICAgICBwcm9wczoge1xuICAgICAgICBhY2NvdW50OiAnMTIzNCcsXG4gICAgICAgIHJlZ2lvbjogJ3Rlc3RyZWdpb24nLFxuICAgICAgICBsb29rdXBSb2xlQXJuOiAnYXJuOiR7QVdTOjpQYXJ0aXRpb259OmlhbTo6MTIzNDpyb2xlL2Nkay1obmI2NTlmZHMtbG9va3VwLXJvbGUtMTIzNC10ZXN0cmVnaW9uJyxcbiAgICAgICAgb3duZXJzOiBbJ2FtYXpvbiddLFxuICAgICAgICBmaWx0ZXJzOiB7XG4gICAgICAgICAgJ25hbWUnOiBbJ2JsYSonXSxcbiAgICAgICAgICAnc3RhdGUnOiBbJ2F2YWlsYWJsZSddLFxuICAgICAgICAgICdpbWFnZS10eXBlJzogWydtYWNoaW5lJ10sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgcHJvdmlkZXI6ICdhbWknLFxuICAgIH0sXG4gIF0pO1xufSk7XG5cbnRlc3QoJ0xvb2t1cE1hY2hpbmVJbWFnZSBjcmVhdGVzIGNvcnJlY3QgdHlwZSBvZiBVc2VyRGF0YScsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBsaW51eERldGFpbHMgPSBuZXcgZWMyLkxvb2t1cE1hY2hpbmVJbWFnZSh7IG5hbWU6ICdibGEqJywgb3duZXJzOiBbJ2FtYXpvbiddIH0pLmdldEltYWdlKHN0YWNrKTtcbiAgY29uc3Qgd2luZG93c0RldGFpbHMgPSBuZXcgZWMyLkxvb2t1cE1hY2hpbmVJbWFnZSh7IG5hbWU6ICdibGEqJywgb3duZXJzOiBbJ2FtYXpvbiddLCB3aW5kb3dzOiB0cnVlIH0pLmdldEltYWdlKHN0YWNrKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChpc1dpbmRvd3NVc2VyRGF0YSh3aW5kb3dzRGV0YWlscy51c2VyRGF0YSkpLnRvQmVUcnV0aHkoKTtcbiAgZXhwZWN0KGlzTGludXhVc2VyRGF0YShsaW51eERldGFpbHMudXNlckRhdGEpKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnY2FjaGVkIGxvb2t1cHMgb2YgQW1hem9uIExpbnV4JywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGFtaSA9IGVjMi5NYWNoaW5lSW1hZ2UubGF0ZXN0QW1hem9uTGludXgoeyBjYWNoZWRJbkNvbnRleHQ6IHRydWUgfSkuZ2V0SW1hZ2Uoc3RhY2spLmltYWdlSWQ7XG5cbiAgLy8gVEhFTlxuICBleHBlY3QoYW1pKS50b0VxdWFsKCdkdW1teS12YWx1ZS1mb3ItL2F3cy9zZXJ2aWNlL2FtaS1hbWF6b24tbGludXgtbGF0ZXN0L2Ftem4tYW1pLWh2bS14ODZfNjQtZ3AyJyk7XG4gIGV4cGVjdChhcHAuc3ludGgoKS5tYW5pZmVzdC5taXNzaW5nKS50b0VxdWFsKFtcbiAgICB7XG4gICAgICBrZXk6ICdzc206YWNjb3VudD0xMjM0OnBhcmFtZXRlck5hbWU9L2F3cy9zZXJ2aWNlL2FtaS1hbWF6b24tbGludXgtbGF0ZXN0L2Ftem4tYW1pLWh2bS14ODZfNjQtZ3AyOnJlZ2lvbj10ZXN0cmVnaW9uJyxcbiAgICAgIHByb3BzOiB7XG4gICAgICAgIGFjY291bnQ6ICcxMjM0JyxcbiAgICAgICAgbG9va3VwUm9sZUFybjogJ2Fybjoke0FXUzo6UGFydGl0aW9ufTppYW06OjEyMzQ6cm9sZS9jZGstaG5iNjU5ZmRzLWxvb2t1cC1yb2xlLTEyMzQtdGVzdHJlZ2lvbicsXG4gICAgICAgIHJlZ2lvbjogJ3Rlc3RyZWdpb24nLFxuICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnL2F3cy9zZXJ2aWNlL2FtaS1hbWF6b24tbGludXgtbGF0ZXN0L2Ftem4tYW1pLWh2bS14ODZfNjQtZ3AyJyxcbiAgICAgIH0sXG4gICAgICBwcm92aWRlcjogJ3NzbScsXG4gICAgfSxcbiAgXSk7XG59KTtcblxudGVzdCgnY2FjaGVkIGxvb2t1cHMgb2YgQW1hem9uIExpbnV4IDInLCAoKSA9PiB7XG4gIC8vIFdIRU5cbiAgY29uc3QgYW1pID0gZWMyLk1hY2hpbmVJbWFnZS5sYXRlc3RBbWF6b25MaW51eCh7XG4gICAgY2FjaGVkSW5Db250ZXh0OiB0cnVlLFxuICAgIGdlbmVyYXRpb246IGVjMi5BbWF6b25MaW51eEdlbmVyYXRpb24uQU1BWk9OX0xJTlVYXzIsXG4gIH0pLmdldEltYWdlKHN0YWNrKS5pbWFnZUlkO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KGFtaSkudG9FcXVhbCgnZHVtbXktdmFsdWUtZm9yLS9hd3Mvc2VydmljZS9hbWktYW1hem9uLWxpbnV4LWxhdGVzdC9hbXpuMi1hbWktaHZtLXg4Nl82NC1ncDInKTtcbiAgZXhwZWN0KGFwcC5zeW50aCgpLm1hbmlmZXN0Lm1pc3NpbmcpLnRvRXF1YWwoW1xuICAgIHtcbiAgICAgIGtleTogJ3NzbTphY2NvdW50PTEyMzQ6cGFyYW1ldGVyTmFtZT0vYXdzL3NlcnZpY2UvYW1pLWFtYXpvbi1saW51eC1sYXRlc3QvYW16bjItYW1pLWh2bS14ODZfNjQtZ3AyOnJlZ2lvbj10ZXN0cmVnaW9uJyxcbiAgICAgIHByb3BzOiB7XG4gICAgICAgIGFjY291bnQ6ICcxMjM0JyxcbiAgICAgICAgbG9va3VwUm9sZUFybjogJ2Fybjoke0FXUzo6UGFydGl0aW9ufTppYW06OjEyMzQ6cm9sZS9jZGstaG5iNjU5ZmRzLWxvb2t1cC1yb2xlLTEyMzQtdGVzdHJlZ2lvbicsXG4gICAgICAgIHJlZ2lvbjogJ3Rlc3RyZWdpb24nLFxuICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnL2F3cy9zZXJ2aWNlL2FtaS1hbWF6b24tbGludXgtbGF0ZXN0L2Ftem4yLWFtaS1odm0teDg2XzY0LWdwMicsXG4gICAgICB9LFxuICAgICAgcHJvdmlkZXI6ICdzc20nLFxuICAgIH0sXG4gIF0pO1xufSk7XG5cbnRlc3QoJ2NhY2hlZCBsb29rdXBzIG9mIEFtYXpvbiBMaW51eCAyIHdpdGgga2VybmVsIDUueCcsICgpID0+IHtcbiAgLy8gV0hFTlxuICBjb25zdCBhbWkgPSBlYzIuTWFjaGluZUltYWdlLmxhdGVzdEFtYXpvbkxpbnV4KHtcbiAgICBjYWNoZWRJbkNvbnRleHQ6IHRydWUsXG4gICAgZ2VuZXJhdGlvbjogZWMyLkFtYXpvbkxpbnV4R2VuZXJhdGlvbi5BTUFaT05fTElOVVhfMixcbiAgICBrZXJuZWw6IGVjMi5BbWF6b25MaW51eEtlcm5lbC5LRVJORUw1X1gsXG4gIH0pLmdldEltYWdlKHN0YWNrKS5pbWFnZUlkO1xuXG4gIC8vIFRIRU5cbiAgZXhwZWN0KGFtaSkudG9FcXVhbCgnZHVtbXktdmFsdWUtZm9yLS9hd3Mvc2VydmljZS9hbWktYW1hem9uLWxpbnV4LWxhdGVzdC9hbXpuMi1hbWkta2VybmVsLTUuMTAtaHZtLXg4Nl82NC1ncDInKTtcbiAgZXhwZWN0KGFwcC5zeW50aCgpLm1hbmlmZXN0Lm1pc3NpbmcpLnRvRXF1YWwoW1xuICAgIHtcbiAgICAgIGtleTogJ3NzbTphY2NvdW50PTEyMzQ6cGFyYW1ldGVyTmFtZT0vYXdzL3NlcnZpY2UvYW1pLWFtYXpvbi1saW51eC1sYXRlc3QvYW16bjItYW1pLWtlcm5lbC01LjEwLWh2bS14ODZfNjQtZ3AyOnJlZ2lvbj10ZXN0cmVnaW9uJyxcbiAgICAgIHByb3BzOiB7XG4gICAgICAgIGFjY291bnQ6ICcxMjM0JyxcbiAgICAgICAgbG9va3VwUm9sZUFybjogJ2Fybjoke0FXUzo6UGFydGl0aW9ufTppYW06OjEyMzQ6cm9sZS9jZGstaG5iNjU5ZmRzLWxvb2t1cC1yb2xlLTEyMzQtdGVzdHJlZ2lvbicsXG4gICAgICAgIHJlZ2lvbjogJ3Rlc3RyZWdpb24nLFxuICAgICAgICBwYXJhbWV0ZXJOYW1lOiAnL2F3cy9zZXJ2aWNlL2FtaS1hbWF6b24tbGludXgtbGF0ZXN0L2Ftem4yLWFtaS1rZXJuZWwtNS4xMC1odm0teDg2XzY0LWdwMicsXG4gICAgICB9LFxuICAgICAgcHJvdmlkZXI6ICdzc20nLFxuICAgIH0sXG4gIF0pO1xufSk7XG5cbnRlc3QoJ3Rocm93IGVycm9yIGlmIHN0b3JhZ2UgcGFyYW0gaXMgc2V0IGZvciBBbWF6b24gTGludXggMjAyMicsICgpID0+IHtcbiAgZXhwZWN0KCgpID0+IHtcbiAgICBlYzIuTWFjaGluZUltYWdlLmxhdGVzdEFtYXpvbkxpbnV4KHtcbiAgICAgIGNhY2hlZEluQ29udGV4dDogdHJ1ZSxcbiAgICAgIGdlbmVyYXRpb246IGVjMi5BbWF6b25MaW51eEdlbmVyYXRpb24uQU1BWk9OX0xJTlVYXzIwMjIsXG4gICAgICBzdG9yYWdlOiBlYzIuQW1hem9uTGludXhTdG9yYWdlLkdFTkVSQUxfUFVSUE9TRSxcbiAgICB9KS5nZXRJbWFnZShzdGFjaykuaW1hZ2VJZDtcbiAgfSkudG9UaHJvdygvU3RvcmFnZSBwYXJhbWV0ZXIgZG9lcyBub3QgZXhpc3QgaW4gc21tIHBhcmFtZXRlciBuYW1lIGZvciBBbWF6b24gTGludXggMjAyMi4vKTtcbn0pO1xuXG50ZXN0KCd0aHJvdyBlcnJvciBpZiB2aXJ0dWFsaXphdGlvbiBwYXJhbSBpcyBzZXQgZm9yIEFtYXpvbiBMaW51eCAyMDIyJywgKCkgPT4ge1xuICBleHBlY3QoKCkgPT4ge1xuICAgIGVjMi5NYWNoaW5lSW1hZ2UubGF0ZXN0QW1hem9uTGludXgoe1xuICAgICAgY2FjaGVkSW5Db250ZXh0OiB0cnVlLFxuICAgICAgZ2VuZXJhdGlvbjogZWMyLkFtYXpvbkxpbnV4R2VuZXJhdGlvbi5BTUFaT05fTElOVVhfMjAyMixcbiAgICAgIHZpcnR1YWxpemF0aW9uOiBlYzIuQW1hem9uTGludXhWaXJ0LkhWTSxcbiAgICB9KS5nZXRJbWFnZShzdGFjaykuaW1hZ2VJZDtcbiAgfSkudG9UaHJvdygvVmlydHVhbGl6YXRpb24gcGFyYW1ldGVyIGRvZXMgbm90IGV4aXN0IGluIHNtbSBwYXJhbWV0ZXIgbmFtZSBmb3IgQW1hem9uIExpbnV4IDIwMjIuLyk7XG59KTtcblxudGVzdCgnY2FjaGVkIGxvb2t1cHMgb2YgQW1hem9uIExpbnV4IDIwMjIgd2l0aCBrZXJuZWwgNS54JywgKCkgPT4ge1xuICAvLyBXSEVOXG4gIGNvbnN0IGFtaSA9IGVjMi5NYWNoaW5lSW1hZ2UubGF0ZXN0QW1hem9uTGludXgoe1xuICAgIGNhY2hlZEluQ29udGV4dDogdHJ1ZSxcbiAgICBnZW5lcmF0aW9uOiBlYzIuQW1hem9uTGludXhHZW5lcmF0aW9uLkFNQVpPTl9MSU5VWF8yMDIyLFxuICB9KS5nZXRJbWFnZShzdGFjaykuaW1hZ2VJZDtcblxuICAvLyBUSEVOXG4gIGV4cGVjdChhbWkpLnRvRXF1YWwoJ2R1bW15LXZhbHVlLWZvci0vYXdzL3NlcnZpY2UvYW1pLWFtYXpvbi1saW51eC1sYXRlc3QvYWwyMDIyLWFtaS1rZXJuZWwtNS4xMC14ODZfNjQnKTtcbiAgZXhwZWN0KGFwcC5zeW50aCgpLm1hbmlmZXN0Lm1pc3NpbmcpLnRvRXF1YWwoW1xuICAgIHtcbiAgICAgIGtleTogJ3NzbTphY2NvdW50PTEyMzQ6cGFyYW1ldGVyTmFtZT0vYXdzL3NlcnZpY2UvYW1pLWFtYXpvbi1saW51eC1sYXRlc3QvYWwyMDIyLWFtaS1rZXJuZWwtNS4xMC14ODZfNjQ6cmVnaW9uPXRlc3RyZWdpb24nLFxuICAgICAgcHJvcHM6IHtcbiAgICAgICAgYWNjb3VudDogJzEyMzQnLFxuICAgICAgICBsb29rdXBSb2xlQXJuOiAnYXJuOiR7QVdTOjpQYXJ0aXRpb259OmlhbTo6MTIzNDpyb2xlL2Nkay1obmI2NTlmZHMtbG9va3VwLXJvbGUtMTIzNC10ZXN0cmVnaW9uJyxcbiAgICAgICAgcmVnaW9uOiAndGVzdHJlZ2lvbicsXG4gICAgICAgIHBhcmFtZXRlck5hbWU6ICcvYXdzL3NlcnZpY2UvYW1pLWFtYXpvbi1saW51eC1sYXRlc3QvYWwyMDIyLWFtaS1rZXJuZWwtNS4xMC14ODZfNjQnLFxuICAgICAgfSxcbiAgICAgIHByb3ZpZGVyOiAnc3NtJyxcbiAgICB9LFxuICBdKTtcbn0pO1xuXG5mdW5jdGlvbiBpc1dpbmRvd3NVc2VyRGF0YSh1ZDogZWMyLlVzZXJEYXRhKSB7XG4gIHJldHVybiB1ZC5yZW5kZXIoKS5pbmRleE9mKCdwb3dlcnNoZWxsJykgPiAtMTtcbn1cblxuZnVuY3Rpb24gaXNMaW51eFVzZXJEYXRhKHVkOiBlYzIuVXNlckRhdGEpIHtcbiAgcmV0dXJuIHVkLnJlbmRlcigpLmluZGV4T2YoJ2Jhc2gnKSA+IC0xO1xufVxuIl19