"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("@aws-cdk/assertions");
const apigw = require("@aws-cdk/aws-apigateway");
const acm = require("@aws-cdk/aws-certificatemanager");
const route53 = require("@aws-cdk/aws-route53");
const core_1 = require("@aws-cdk/core");
const targets = require("../lib");
test('targets.ApiGateway can be used to the default domain of an APIGW', () => {
    // GIVEN
    const stack = new core_1.Stack();
    const cert = new acm.Certificate(stack, 'cert', { domainName: 'example.com' });
    const api = new apigw.RestApi(stack, 'api', {
        domainName: {
            domainName: 'example.com',
            certificate: cert,
        },
    });
    const zone = new route53.HostedZone(stack, 'zone', {
        zoneName: 'example.com',
    });
    api.root.addMethod('GET');
    // WHEN
    new route53.ARecord(stack, 'A', {
        zone,
        target: route53.RecordTarget.fromAlias(new targets.ApiGateway(api)),
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Name: 'example.com.',
        Type: 'A',
        AliasTarget: {
            DNSName: {
                'Fn::GetAtt': [
                    'apiCustomDomain64773C4F',
                    'RegionalDomainName',
                ],
            },
            HostedZoneId: {
                'Fn::GetAtt': [
                    'apiCustomDomain64773C4F',
                    'RegionalHostedZoneId',
                ],
            },
        },
        HostedZoneId: {
            Ref: 'zoneEB40FF1E',
        },
    });
});
test('targets.ApiGatewayDomain can be used to directly reference a domain', () => {
    // GIVEN
    const stack = new core_1.Stack();
    const cert = new acm.Certificate(stack, 'cert', { domainName: 'example.com' });
    const domain = new apigw.DomainName(stack, 'domain', { domainName: 'example.com', certificate: cert });
    const zone = new route53.HostedZone(stack, 'zone', {
        zoneName: 'example.com',
    });
    // WHEN
    new route53.ARecord(stack, 'A', {
        zone,
        target: route53.RecordTarget.fromAlias(new targets.ApiGatewayDomain(domain)),
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Name: 'example.com.',
        Type: 'A',
        AliasTarget: {
            DNSName: {
                'Fn::GetAtt': [
                    'domainFBFFA2F6',
                    'RegionalDomainName',
                ],
            },
            HostedZoneId: {
                'Fn::GetAtt': [
                    'domainFBFFA2F6',
                    'RegionalHostedZoneId',
                ],
            },
        },
        HostedZoneId: {
            Ref: 'zoneEB40FF1E',
        },
    });
});
test('fails if an ApiGateway is used with an API that does not define a domain name', () => {
    // GIVEN
    const stack = new core_1.Stack();
    const api = new apigw.RestApi(stack, 'api');
    const zone = new route53.HostedZone(stack, 'zone', {
        zoneName: 'example.com',
    });
    api.root.addMethod('GET');
    // THEN
    expect(() => {
        new route53.ARecord(stack, 'A', {
            zone,
            target: route53.RecordTarget.fromAlias(new targets.ApiGateway(api)),
        });
    }).toThrow(/API does not define a default domain name/);
});
test('targets.ApiGateway accepts a SpecRestApi', () => {
    // GIVEN
    const stack = new core_1.Stack();
    const cert = new acm.Certificate(stack, 'cert', { domainName: 'example.com' });
    const api = new apigw.SpecRestApi(stack, 'api', {
        domainName: {
            domainName: 'example.com',
            certificate: cert,
        },
        apiDefinition: apigw.ApiDefinition.fromInline({
            key1: 'val1',
        }),
    });
    const zone = new route53.HostedZone(stack, 'zone', {
        zoneName: 'example.com',
    });
    api.root.addMethod('GET');
    // WHEN
    new route53.ARecord(stack, 'A', {
        zone,
        target: route53.RecordTarget.fromAlias(new targets.ApiGateway(api)),
    });
    // THEN
    assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::Route53::RecordSet', {
        Name: 'example.com.',
        Type: 'A',
        AliasTarget: {
            DNSName: {
                'Fn::GetAtt': [
                    'apiCustomDomain64773C4F',
                    'RegionalDomainName',
                ],
            },
            HostedZoneId: {
                'Fn::GetAtt': [
                    'apiCustomDomain64773C4F',
                    'RegionalHostedZoneId',
                ],
            },
        },
        HostedZoneId: {
            Ref: 'zoneEB40FF1E',
        },
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpZ2F0ZXdheS10YXJnZXQudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImFwaWdhdGV3YXktdGFyZ2V0LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxvREFBK0M7QUFDL0MsaURBQWlEO0FBQ2pELHVEQUF1RDtBQUN2RCxnREFBZ0Q7QUFDaEQsd0NBQXNDO0FBQ3RDLGtDQUFrQztBQUVsQyxJQUFJLENBQUMsa0VBQWtFLEVBQUUsR0FBRyxFQUFFO0lBQzVFLFFBQVE7SUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO0lBQzFCLE1BQU0sSUFBSSxHQUFHLElBQUksR0FBRyxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUUsVUFBVSxFQUFFLGFBQWEsRUFBRSxDQUFDLENBQUM7SUFDL0UsTUFBTSxHQUFHLEdBQUcsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUU7UUFDMUMsVUFBVSxFQUFFO1lBQ1YsVUFBVSxFQUFFLGFBQWE7WUFDekIsV0FBVyxFQUFFLElBQUk7U0FDbEI7S0FDRixDQUFDLENBQUM7SUFDSCxNQUFNLElBQUksR0FBRyxJQUFJLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRTtRQUNqRCxRQUFRLEVBQUUsYUFBYTtLQUN4QixDQUFDLENBQUM7SUFDSCxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUUxQixPQUFPO0lBQ1AsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUU7UUFDOUIsSUFBSTtRQUNKLE1BQU0sRUFBRSxPQUFPLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDcEUsQ0FBQyxDQUFDO0lBRUgsT0FBTztJQUNQLHFCQUFRLENBQUMsU0FBUyxDQUFD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RTtZQUNYLE9BQU8sRUFBRTtnQkFDUCxZQUFZLEVBQUU7b0JBQ1oseUJBQXlCO29CQUN6QixvQkFBb0I7aUJBQ3JCO2FBQ0Y7WUFDRCxZQUFZLEVBQUU7Z0JBQ1osWUFBWSxFQUFFO29CQUNaLHlCQUF5QjtvQkFDekIsc0JBQXNCO2lCQUN2QjthQUNGO1NBQ0Y7UUFDRCxZQUFZLEVBQUU7WUFDWixHQUFHLEVBQUUsY0FBYztTQUNwQjtLQUNGLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVtcGxhdGUgfSBmcm9tICdAYXdzLWNkay9hc3NlcnRpb25zJztcbmltcG9ydCAqIGFzIGFwaWd3IGZyb20gJ0Bhd3MtY2RrL2F3cy1hcGlnYXRld2F5JztcbmltcG9ydCAqIGFzIGFjbSBmcm9tICdAYXdzLWNkay9hd3MtY2VydGlmaWNhdGVtYW5hZ2VyJztcbmltcG9ydCAqIGFzIHJvdXRlNTMgZnJvbSAnQGF3cy1jZGsvYXdzLXJvdXRlNTMnO1xuaW1wb3J0IHsgU3RhY2sgfSBmcm9tICdAYXdzLWNkay9jb3JlJztcbmltcG9ydCAqIGFzIHRhcmdldHMgZnJvbSAnLi4vbGliJztcblxudGVzdCgndGFyZ2V0cy5BcGlHYXRld2F5IGNhbiBiZSB1c2VkIHRvIHRoZSBkZWZhdWx0IGRvbWFpbiBvZiBhbiBBUElHVycsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgY29uc3QgY2VydCA9IG5ldyBhY20uQ2VydGlmaWNhdGUoc3RhY2ssICdjZXJ0JywgeyBkb21haW5OYW1lOiAnZXhhbXBsZS5jb20nIH0pO1xuICBjb25zdCBhcGkgPSBuZXcgYXBpZ3cuUmVzdEFwaShzdGFjaywgJ2FwaScsIHtcbiAgICBkb21haW5OYW1lOiB7XG4gICAgICBkb21haW5OYW1lOiAnZXhhbXBsZS5jb20nLFxuICAgICAgY2VydGlmaWNhdGU6IGNlcnQsXG4gICAgfSxcbiAgfSk7XG4gIGNvbnN0IHpvbmUgPSBuZXcgcm91dGU1My5Ib3N0ZWRab25lKHN0YWNrLCAnem9uZScsIHtcbiAgICB6b25lTmFtZTogJ2V4YW1wbGUuY29tJyxcbiAgfSk7XG4gIGFwaS5yb290LmFkZE1ldGhvZCgnR0VUJyk7XG5cbiAgLy8gV0hFTlxuICBuZXcgcm91dGU1My5BUmVjb3JkKHN0YWNrLCAnQScsIHtcbiAgICB6b25lLFxuICAgIHRhcmdldDogcm91dGU1My5SZWNvcmRUYXJnZXQuZnJvbUFsaWFzKG5ldyB0YXJnZXRzLkFwaUdhdGV3YXkoYXBpKSksXG4gIH0pO1xuXG4gIC8vIFRIRU5cbiAgVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6Um91dGU1Mzo6UmVjb3JkU2V0Jywge1xuICAgIE5hbWU6ICdleGFtcGxlLmNvbS4nLFxuICAgIFR5cGU6ICdBJyxcbiAgICBBbGlhc1RhcmdldDoge1xuICAgICAgRE5TTmFtZToge1xuICAgICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgICAnYXBpQ3VzdG9tRG9tYWluNjQ3NzNDNEYnLFxuICAgICAgICAgICdSZWdpb25hbERvbWFpbk5hbWUnLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICAgIEhvc3RlZFpvbmVJZDoge1xuICAgICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgICAnYXBpQ3VzdG9tRG9tYWluNjQ3NzNDNEYnLFxuICAgICAgICAgICdSZWdpb25hbEhvc3RlZFpvbmVJZCcsXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgSG9zdGVkWm9uZUlkOiB7XG4gICAgICBSZWY6ICd6b25lRUI0MEZGMUUnLFxuICAgIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3RhcmdldHMuQXBpR2F0ZXdheURvbWFpbiBjYW4gYmUgdXNlZCB0byBkaXJlY3RseSByZWZlcmVuY2UgYSBkb21haW4nLCAoKSA9PiB7XG4gIC8vIEdJVkVOXG4gIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIGNvbnN0IGNlcnQgPSBuZXcgYWNtLkNlcnRpZmljYXRlKHN0YWNrLCAnY2VydCcsIHsgZG9tYWluTmFtZTogJ2V4YW1wbGUuY29tJyB9KTtcbiAgY29uc3QgZG9tYWluID0gbmV3IGFwaWd3LkRvbWFpbk5hbWUoc3RhY2ssICdkb21haW4nLCB7IGRvbWFpbk5hbWU6ICdleGFtcGxlLmNvbScsIGNlcnRpZmljYXRlOiBjZXJ0IH0pO1xuICBjb25zdCB6b25lID0gbmV3IHJvdXRlNTMuSG9zdGVkWm9uZShzdGFjaywgJ3pvbmUnLCB7XG4gICAgem9uZU5hbWU6ICdleGFtcGxlLmNvbScsXG4gIH0pO1xuXG4gIC8vIFdIRU5cbiAgbmV3IHJvdXRlNTMuQVJlY29yZChzdGFjaywgJ0EnLCB7XG4gICAgem9uZSxcbiAgICB0YXJnZXQ6IHJvdXRlNTMuUmVjb3JkVGFyZ2V0LmZyb21BbGlhcyhuZXcgdGFyZ2V0cy5BcGlHYXRld2F5RG9tYWluKGRvbWFpbikpLFxuICB9KTtcblxuICAvLyBUSEVOXG4gIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OlJvdXRlNTM6OlJlY29yZFNldCcsIHtcbiAgICBOYW1lOiAnZXhhbXBsZS5jb20uJyxcbiAgICBUeXBlOiAnQScsXG4gICAgQWxpYXNUYXJnZXQ6IHtcbiAgICAgIEROU05hbWU6IHtcbiAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgJ2RvbWFpbkZCRkZBMkY2JyxcbiAgICAgICAgICAnUmVnaW9uYWxEb21haW5OYW1lJyxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgICBIb3N0ZWRab25lSWQ6IHtcbiAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgJ2RvbWFpbkZCRkZBMkY2JyxcbiAgICAgICAgICAnUmVnaW9uYWxIb3N0ZWRab25lSWQnLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICB9LFxuICAgIEhvc3RlZFpvbmVJZDoge1xuICAgICAgUmVmOiAnem9uZUVCNDBGRjFFJyxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdmYWlscyBpZiBhbiBBcGlHYXRld2F5IGlzIHVzZWQgd2l0aCBhbiBBUEkgdGhhdCBkb2VzIG5vdCBkZWZpbmUgYSBkb21haW4gbmFtZScsICgpID0+IHtcbiAgLy8gR0lWRU5cbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgY29uc3QgYXBpID0gbmV3IGFwaWd3LlJlc3RBcGkoc3RhY2ssICdhcGknKTtcbiAgY29uc3Qgem9uZSA9IG5ldyByb3V0ZTUzLkhvc3RlZFpvbmUoc3RhY2ssICd6b25lJywge1xuICAgIHpvbmVOYW1lOiAnZXhhbXBsZS5jb20nLFxuICB9KTtcbiAgYXBpLnJvb3QuYWRkTWV0aG9kKCdHRVQnKTtcblxuICAvLyBUSEVOXG4gIGV4cGVjdCgoKSA9PiB7XG4gICAgbmV3IHJvdXRlNTMuQVJlY29yZChzdGFjaywgJ0EnLCB7XG4gICAgICB6b25lLFxuICAgICAgdGFyZ2V0OiByb3V0ZTUzLlJlY29yZFRhcmdldC5mcm9tQWxpYXMobmV3IHRhcmdldHMuQXBpR2F0ZXdheShhcGkpKSxcbiAgICB9KTtcbiAgfSkudG9UaHJvdygvQVBJIGRvZXMgbm90IGRlZmluZSBhIGRlZmF1bHQgZG9tYWluIG5hbWUvKTtcbn0pO1xuXG50ZXN0KCd0YXJnZXRzLkFwaUdhdGV3YXkgYWNjZXB0cyBhIFNwZWNSZXN0QXBpJywgKCkgPT4ge1xuICAvLyBHSVZFTlxuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICBjb25zdCBjZXJ0ID0gbmV3IGFjbS5DZXJ0aWZpY2F0ZShzdGFjaywgJ2NlcnQnLCB7IGRvbWFpbk5hbWU6ICdleGFtcGxlLmNvbScgfSk7XG4gIGNvbnN0IGFwaSA9IG5ldyBhcGlndy5TcGVjUmVzdEFwaShzdGFjaywgJ2FwaScsIHtcbiAgICBkb21haW5OYW1lOiB7XG4gICAgICBkb21haW5OYW1lOiAnZXhhbXBsZS5jb20nLFxuICAgICAgY2VydGlmaWNhdGU6IGNlcnQsXG4gICAgfSxcbiAgICBhcGlEZWZpbml0aW9uOiBhcGlndy5BcGlEZWZpbml0aW9uLmZyb21JbmxpbmUoe1xuICAgICAga2V5MTogJ3ZhbDEnLFxuICAgIH0pLFxuICB9KTtcbiAgY29uc3Qgem9uZSA9IG5ldyByb3V0ZTUzLkhvc3RlZFpvbmUoc3RhY2ssICd6b25lJywge1xuICAgIHpvbmVOYW1lOiAnZXhhbXBsZS5jb20nLFxuICB9KTtcbiAgYXBpLnJvb3QuYWRkTWV0aG9kKCdHRVQnKTtcblxuICAvLyBXSEVOXG4gIG5ldyByb3V0ZTUzLkFSZWNvcmQoc3RhY2ssICdBJywge1xuICAgIHpvbmUsXG4gICAgdGFyZ2V0OiByb3V0ZTUzLlJlY29yZFRhcmdldC5mcm9tQWxpYXMobmV3IHRhcmdldHMuQXBpR2F0ZXdheShhcGkpKSxcbiAgfSk7XG5cbiAgLy8gVEhFTlxuICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpSb3V0ZTUzOjpSZWNvcmRTZXQnLCB7XG4gICAgTmFtZTogJ2V4YW1wbGUuY29tLicsXG4gICAgVHlwZTogJ0EnLFxuICAgIEFsaWFzVGFyZ2V0OiB7XG4gICAgICBETlNOYW1lOiB7XG4gICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICdhcGlDdXN0b21Eb21haW42NDc3M0M0RicsXG4gICAgICAgICAgJ1JlZ2lvbmFsRG9tYWluTmFtZScsXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgICAgSG9zdGVkWm9uZUlkOiB7XG4gICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICdhcGlDdXN0b21Eb21haW42NDc3M0M0RicsXG4gICAgICAgICAgJ1JlZ2lvbmFsSG9zdGVkWm9uZUlkJyxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBIb3N0ZWRab25lSWQ6IHtcbiAgICAgIFJlZjogJ3pvbmVFQjQwRkYxRScsXG4gICAgfSxcbiAgfSk7XG59KTsiXX0=