"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const assertions_1 = require("@aws-cdk/assertions");
const cdk = require("@aws-cdk/core");
const apigateway = require("../lib");
const RESOURCE_TYPE = 'AWS::ApiGateway::UsagePlan';
describe('usage plan', () => {
    test('default setup', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const api = new apigateway.RestApi(stack, 'my-api', { cloudWatchRole: false, deploy: false });
        api.root.addMethod('GET'); // Need at least one method on the api
        const usagePlanName = 'Pro';
        const usagePlanDescription = 'Pro Usage Plan with no throttling limits';
        // WHEN
        new apigateway.UsagePlan(stack, 'my-usage-plan', {
            name: usagePlanName,
            description: usagePlanDescription,
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties(RESOURCE_TYPE, {
            UsagePlanName: usagePlanName,
            Description: usagePlanDescription,
        });
    });
    test('usage plan with integer throttling limits', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const api = new apigateway.RestApi(stack, 'my-api', { cloudWatchRole: false, deploy: true, deployOptions: { stageName: 'test' } });
        const method = api.root.addMethod('GET'); // Need at least one method on the api
        const usagePlanName = 'Basic';
        const usagePlanDescription = 'Basic Usage Plan with integer throttling limits';
        // WHEN
        new apigateway.UsagePlan(stack, 'my-usage-plan', {
            name: usagePlanName,
            description: usagePlanDescription,
            apiStages: [
                {
                    stage: api.deploymentStage,
                    throttle: [
                        {
                            method,
                            throttle: {
                                burstLimit: 20,
                                rateLimit: 10,
                            },
                        },
                    ],
                },
            ],
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties(RESOURCE_TYPE, {
            UsagePlanName: usagePlanName,
            Description: usagePlanDescription,
            ApiStages: [
                {
                    ApiId: {
                        Ref: 'myapi4C7BF186',
                    },
                    Stage: {
                        Ref: 'myapiDeploymentStagetest4A4AB65E',
                    },
                    Throttle: {
                        '//GET': {
                            BurstLimit: 20,
                            RateLimit: 10,
                        },
                    },
                },
            ],
        });
    });
    test('usage plan with integer and float throttling limits', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const api = new apigateway.RestApi(stack, 'my-api', { cloudWatchRole: false, deploy: true, deployOptions: { stageName: 'test' } });
        const method = api.root.addMethod('GET'); // Need at least one method on the api
        const usagePlanName = 'Basic';
        const usagePlanDescription = 'Basic Usage Plan with integer and float throttling limits';
        // WHEN
        new apigateway.UsagePlan(stack, 'my-usage-plan', {
            name: usagePlanName,
            description: usagePlanDescription,
            apiStages: [
                {
                    stage: api.deploymentStage,
                    throttle: [
                        {
                            method,
                            throttle: {
                                burstLimit: 20,
                                rateLimit: 10.5,
                            },
                        },
                    ],
                },
            ],
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties(RESOURCE_TYPE, {
            UsagePlanName: usagePlanName,
            Description: usagePlanDescription,
            ApiStages: [
                {
                    ApiId: {
                        Ref: 'myapi4C7BF186',
                    },
                    Stage: {
                        Ref: 'myapiDeploymentStagetest4A4AB65E',
                    },
                    Throttle: {
                        '//GET': {
                            BurstLimit: 20,
                            RateLimit: 10.5,
                        },
                    },
                },
            ],
        });
    });
    test('usage plan with blocked methods', () => {
        // GIVEN
        const stack = new cdk.Stack();
        const api = new apigateway.RestApi(stack, 'my-api', { cloudWatchRole: false, deploy: true, deployOptions: { stageName: 'test' } });
        const method = api.root.addMethod('GET'); // Need at least one method on the api
        const usagePlanName = 'Basic';
        const usagePlanDescription = 'Basic Usage Plan with throttling limits';
        // WHEN
        new apigateway.UsagePlan(stack, 'my-usage-plan', {
            name: usagePlanName,
            description: usagePlanDescription,
            apiStages: [
                {
                    stage: api.deploymentStage,
                    throttle: [
                        {
                            method,
                            throttle: {
                                burstLimit: 0,
                                rateLimit: 0,
                            },
                        },
                    ],
                },
            ],
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties(RESOURCE_TYPE, {
            UsagePlanName: usagePlanName,
            Description: usagePlanDescription,
            ApiStages: [
                {
                    ApiId: {
                        Ref: 'myapi4C7BF186',
                    },
                    Stage: {
                        Ref: 'myapiDeploymentStagetest4A4AB65E',
                    },
                    Throttle: {
                        '//GET': {
                            BurstLimit: 0,
                            RateLimit: 0,
                        },
                    },
                },
            ],
        });
    });
    test('usage plan with quota limits', () => {
        // GIVEN
        const stack = new cdk.Stack();
        // WHEN
        new apigateway.UsagePlan(stack, 'my-usage-plan', {
            quota: {
                limit: 10000,
                period: apigateway.Period.MONTH,
            },
        });
        // THEN
        assertions_1.Template.fromStack(stack).hasResourceProperties(RESOURCE_TYPE, {
            Quota: {
                Limit: 10000,
                Period: 'MONTH',
            },
        });
    });
    describe('UsagePlanKey', () => {
        test('default', () => {
            // GIVEN
            const stack = new cdk.Stack();
            const usagePlan = new apigateway.UsagePlan(stack, 'my-usage-plan', {
                name: 'Basic',
            });
            const apiKey = new apigateway.ApiKey(stack, 'my-api-key');
            // WHEN
            usagePlan.addApiKey(apiKey);
            // THEN
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::UsagePlanKey', {
                KeyId: {
                    Ref: 'myapikey1B052F70',
                },
                KeyType: 'API_KEY',
                UsagePlanId: {
                    Ref: 'myusageplan23AA1E32',
                },
            });
        });
        test('imported', () => {
            // GIVEN
            const stack = new cdk.Stack();
            const usagePlan = apigateway.UsagePlan.fromUsagePlanId(stack, 'my-usage-plan', 'imported-id');
            const apiKey = new apigateway.ApiKey(stack, 'my-api-key');
            // WHEN
            usagePlan.addApiKey(apiKey);
            // THEN
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::UsagePlanKey', {
                KeyId: {
                    Ref: 'myapikey1B052F70',
                },
                KeyType: 'API_KEY',
                UsagePlanId: 'imported-id',
            });
        });
        test('multiple keys', () => {
            // GIVEN
            const stack = new cdk.Stack();
            const usagePlan = new apigateway.UsagePlan(stack, 'my-usage-plan');
            const apiKey1 = new apigateway.ApiKey(stack, 'my-api-key-1', {
                apiKeyName: 'my-api-key-1',
            });
            const apiKey2 = new apigateway.ApiKey(stack, 'my-api-key-2', {
                apiKeyName: 'my-api-key-2',
            });
            // WHEN
            usagePlan.addApiKey(apiKey1);
            usagePlan.addApiKey(apiKey2);
            // THEN
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::ApiKey', {
                Name: 'my-api-key-1',
            });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::ApiKey', {
                Name: 'my-api-key-2',
            });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::UsagePlanKey', {
                KeyId: {
                    Ref: 'myapikey11F723FC7',
                },
            });
            assertions_1.Template.fromStack(stack).hasResourceProperties('AWS::ApiGateway::UsagePlanKey', {
                KeyId: {
                    Ref: 'myapikey2ABDEF012',
                },
            });
        });
        test('overrideLogicalId', () => {
            // GIVEN
            const app = new cdk.App();
            const stack = new cdk.Stack(app);
            const usagePlan = new apigateway.UsagePlan(stack, 'my-usage-plan', { name: 'Basic' });
            const apiKey = new apigateway.ApiKey(stack, 'my-api-key');
            // WHEN
            usagePlan.addApiKey(apiKey, { overrideLogicalId: 'mylogicalid' });
            // THEN
            const template = app.synth().getStackByName(stack.stackName).template;
            const logicalIds = Object.entries(template.Resources)
                .filter(([_, v]) => v.Type === 'AWS::ApiGateway::UsagePlanKey')
                .map(([k, _]) => k);
            expect(logicalIds).toEqual(['mylogicalid']);
        });
        test('UsagePlanKeys have unique logical ids', () => {
            // GIVEN
            const app = new cdk.App();
            const stack = new cdk.Stack(app, 'my-stack');
            const usagePlan = new apigateway.UsagePlan(stack, 'my-usage-plan');
            const apiKey1 = new apigateway.ApiKey(stack, 'my-api-key-1', {
                apiKeyName: 'my-api-key-1',
            });
            const apiKey2 = new apigateway.ApiKey(stack, 'my-api-key-2', {
                apiKeyName: 'my-api-key-2',
            });
            // WHEN
            usagePlan.addApiKey(apiKey1);
            usagePlan.addApiKey(apiKey2);
            // THEN
            const template = app.synth().getStackByName(stack.stackName).template;
            const logicalIds = Object.entries(template.Resources)
                .filter(([_, v]) => v.Type === 'AWS::ApiGateway::UsagePlanKey')
                .map(([k, _]) => k);
            expect(logicalIds).toEqual([
                'myusageplanUsagePlanKeyResourcemystackmyapikey1EE9AA1B359121274',
                'myusageplanUsagePlanKeyResourcemystackmyapikey2B4E8EB1456DC88E9',
            ]);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNhZ2UtcGxhbi50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXNhZ2UtcGxhbi50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsb0RBQStDO0FBQy9DLHFDQUFxQztBQUNyQyxxQ0FBcUM7QUFFckMsTUFBTSxhQUFhLEdBQUcsNEJBQTRCLENBQUM7QUFDbkQsUUFBUSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUU7SUFDMUIsSUFBSSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7UUFDekIsUUFBUTtRQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzlCLE1BQU0sR0FBRyxHQUFHLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUM5RixHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLHNDQUFzQztRQUNqRSxNQUFNLGFBQWEsR0FBRyxLQUFLLENBQUM7UUFDNUIsTUFBTSxvQkFBb0IsR0FBRywwQ0FBMEMsQ0FBQztRQUV4RSxPQUFPO1FBQ1AsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxlQUFlLEVBQUU7WUFDL0MsSUFBSSxFQUFFLGFBQWE7WUFDbkIsV0FBVyxFQUFFLG9CQUFvQjtTQUNsQyxDQUFDLENBQUM7UUFFSCxPQUFPO1FBQ1AscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsYUFBYSxFQUFFO1lBQzdELGFBQWEsRUFBRSxhQUFhO1lBQzVCLFdBQVcsRUFBRSxvQkFBb0I7U0FDbEMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO1FBQ3JELFFBQVE7UUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM5QixNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLGNBQWMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ25JLE1BQU0sTUFBTSxHQUFzQixHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLHNDQUFzQztRQUNuRyxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUM7UUFDOUIsTUFBTSxvQkFBb0IsR0FBRyxpREFBaUQsQ0FBQztRQUUvRSxPQUFPO1FBQ1AsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxlQUFlLEVBQUU7WUFDL0MsSUFBSSxFQUFFLGFBQWE7WUFDbkIsV0FBVyxFQUFFLG9CQUFvQjtZQUNqQyxTQUFTLEVBQUU7Z0JBQ1Q7b0JBQ0UsS0FBSyxFQUFFLEdBQUcsQ0FBQyxlQUFlO29CQUMxQixRQUFRLEVBQUU7d0JBQ1I7NEJBQ0UsTUFBTTs0QkFDTixRQUFRLEVBQUU7Z0NBQ1IsVUFBVSxFQUFFLEVBQUU7Z0NBQ2QsU0FBUyxFQUFFLEVBQUU7NkJBQ2Q7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQztRQUVILE9BQU87UUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLEVBQUU7WUFDN0QsYUFBYSxFQUFFLGFBQWE7WUFDNUIsV0FBVyxFQUFFLG9CQUFvQjtZQUNqQyxTQUFTLEVBQUU7Z0JBQ1Q7b0JBQ0UsS0FBSyxFQUFFO3dCQUNMLEdBQUcsRUFBRSxlQUFlO3FCQUNyQjtvQkFDRCxLQUFLLEVBQUU7d0JBQ0wsR0FBRyxFQUFFLGtDQUFrQztxQkFDeEM7b0JBQ0QsUUFBUSxFQUFFO3dCQUNSLE9BQU8sRUFBRTs0QkFDUCxVQUFVLEVBQUUsRUFBRTs0QkFDZCxTQUFTLEVBQUUsRUFBRTt5QkFDZDtxQkFDRjtpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMscURBQXFELEVBQUUsR0FBRyxFQUFFO1FBQy9ELFFBQVE7UUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM5QixNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLGNBQWMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ25JLE1BQU0sTUFBTSxHQUFzQixHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLHNDQUFzQztRQUNuRyxNQUFNLGFBQWEsR0FBRyxPQUFPLENBQUM7UUFDOUIsTUFBTSxvQkFBb0IsR0FBRywyREFBMkQsQ0FBQztRQUV6RixPQUFPO1FBQ1AsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxlQUFlLEVBQUU7WUFDL0MsSUFBSSxFQUFFLGFBQWE7WUFDbkIsV0FBVyxFQUFFLG9CQUFvQjtZQUNqQyxTQUFTLEVBQUU7Z0JBQ1Q7b0JBQ0UsS0FBSyxFQUFFLEdBQUcsQ0FBQyxlQUFlO29CQUMxQixRQUFRLEVBQUU7d0JBQ1I7NEJBQ0UsTUFBTTs0QkFDTixRQUFRLEVBQUU7Z0NBQ1IsVUFBVSxFQUFFLEVBQUU7Z0NBQ2QsU0FBUyxFQUFFLElBQUk7NkJBQ2hCO3lCQUNGO3FCQUNGO2lCQUNGO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCxPQUFPO1FBQ1AscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsYUFBYSxFQUFFO1lBQzdELGFBQWEsRUFBRSxhQUFhO1lBQzVCLFdBQVcsRUFBRSxvQkFBb0I7WUFDakMsU0FBUyxFQUFFO2dCQUNUO29CQUNFLEtBQUssRUFBRTt3QkFDTCxHQUFHLEVBQUUsZUFBZTtxQkFDckI7b0JBQ0QsS0FBSyxFQUFFO3dCQUNMLEdBQUcsRUFBRSxrQ0FBa0M7cUJBQ3hDO29CQUNELFFBQVEsRUFBRTt3QkFDUixPQUFPLEVBQUU7NEJBQ1AsVUFBVSxFQUFFLEVBQUU7NEJBQ2QsU0FBUyxFQUFFLElBQUk7eUJBQ2hCO3FCQUNGO2lCQUNGO2FBQ0Y7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7UUFDM0MsUUFBUTtRQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzlCLE1BQU0sR0FBRyxHQUFHLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDbkksTUFBTSxNQUFNLEdBQXNCLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsc0NBQXNDO1FBQ25HLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQztRQUM5QixNQUFNLG9CQUFvQixHQUFHLHlDQUF5QyxDQUFDO1FBRXZFLE9BQU87UUFDUCxJQUFJLFVBQVUsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLGVBQWUsRUFBRTtZQUMvQyxJQUFJLEVBQUUsYUFBYTtZQUNuQixXQUFXLEVBQUUsb0JBQW9CO1lBQ2pDLFNBQVMsRUFBRTtnQkFDVDtvQkFDRSxLQUFLLEVBQUUsR0FBRyxDQUFDLGVBQWU7b0JBQzFCLFFBQVEsRUFBRTt3QkFDUjs0QkFDRSxNQUFNOzRCQUNOLFFBQVEsRUFBRTtnQ0FDUixVQUFVLEVBQUUsQ0FBQztnQ0FDYixTQUFTLEVBQUUsQ0FBQzs2QkFDYjt5QkFDRjtxQkFDRjtpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLGFBQWEsRUFBRTtZQUM3RCxhQUFhLEVBQUUsYUFBYTtZQUM1QixXQUFXLEVBQUUsb0JBQW9CO1lBQ2pDLFNBQVMsRUFBRTtnQkFDVDtvQkFDRSxLQUFLLEVBQUU7d0JBQ0wsR0FBRyxFQUFFLGVBQWU7cUJBQ3JCO29CQUNELEtBQUssRUFBRTt3QkFDTCxHQUFHLEVBQUUsa0NBQWtDO3FCQUN4QztvQkFDRCxRQUFRLEVBQUU7d0JBQ1IsT0FBTyxFQUFFOzRCQUNQLFVBQVUsRUFBRSxDQUFDOzRCQUNiLFNBQVMsRUFBRSxDQUFDO3lCQUNiO3FCQUNGO2lCQUNGO2FBQ0Y7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7UUFDeEMsUUFBUTtRQUNSLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBRTlCLE9BQU87UUFDUCxJQUFJLFVBQVUsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLGVBQWUsRUFBRTtZQUMvQyxLQUFLLEVBQUU7Z0JBQ0wsS0FBSyxFQUFFLEtBQUs7Z0JBQ1osTUFBTSxFQUFFLFVBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSzthQUNoQztTQUNGLENBQUMsQ0FBQztRQUVILE9BQU87UUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxhQUFhLEVBQUU7WUFDN0QsS0FBSyxFQUFFO2dCQUNMLEtBQUssRUFBRSxLQUFLO2dCQUNaLE1BQU0sRUFBRSxPQUFPO2FBQ2hCO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsY0FBYyxFQUFFLEdBQUcsRUFBRTtRQUU1QixJQUFJLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtZQUNuQixRQUFRO1lBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDOUIsTUFBTSxTQUFTLEdBQXlCLElBQUksVUFBVSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsZUFBZSxFQUFFO2dCQUN2RixJQUFJLEVBQUUsT0FBTzthQUNkLENBQUMsQ0FBQztZQUNILE1BQU0sTUFBTSxHQUFzQixJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDO1lBRTdFLE9BQU87WUFDUCxTQUFTLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRTVCLE9BQU87WUFDUCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQywrQkFBK0IsRUFBRTtnQkFDL0UsS0FBSyxFQUFFO29CQUNMLEdBQUcsRUFBRSxrQkFBa0I7aUJBQ3hCO2dCQUNELE9BQU8sRUFBRSxTQUFTO2dCQUNsQixXQUFXLEVBQUU7b0JBQ1gsR0FBRyxFQUFFLHFCQUFxQjtpQkFDM0I7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUdILElBQUksQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFO1lBQ3BCLFFBQVE7WUFDUixNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUM5QixNQUFNLFNBQVMsR0FBMEIsVUFBVSxDQUFDLFNBQVMsQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLGVBQWUsRUFBRSxhQUFhLENBQUMsQ0FBQztZQUNySCxNQUFNLE1BQU0sR0FBc0IsSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztZQUU3RSxPQUFPO1lBQ1AsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUU1QixPQUFPO1lBQ1AscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsK0JBQStCLEVBQUU7Z0JBQy9FLEtBQUssRUFBRTtvQkFDTCxHQUFHLEVBQUUsa0JBQWtCO2lCQUN4QjtnQkFDRCxPQUFPLEVBQUUsU0FBUztnQkFDbEIsV0FBVyxFQUFFLGFBQWE7YUFDM0IsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtZQUN6QixRQUFRO1lBQ1IsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDOUIsTUFBTSxTQUFTLEdBQUcsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxlQUFlLENBQUMsQ0FBQztZQUNuRSxNQUFNLE9BQU8sR0FBRyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLGNBQWMsRUFBRTtnQkFDM0QsVUFBVSxFQUFFLGNBQWM7YUFDM0IsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxPQUFPLEdBQUcsSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxjQUFjLEVBQUU7Z0JBQzNELFVBQVUsRUFBRSxjQUFjO2FBQzNCLENBQUMsQ0FBQztZQUVILE9BQU87WUFDUCxTQUFTLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzdCLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFN0IsT0FBTztZQUNQLHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLHlCQUF5QixFQUFFO2dCQUN6RSxJQUFJLEVBQUUsY0FBYzthQUNyQixDQUFDLENBQUM7WUFDSCxxQkFBUSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyx5QkFBeUIsRUFBRTtnQkFDekUsSUFBSSxFQUFFLGNBQWM7YUFDckIsQ0FBQyxDQUFDO1lBQ0gscUJBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMscUJBQXFCLENBQUMsK0JBQStCLEVBQUU7Z0JBQy9FLEtBQUssRUFBRTtvQkFDTCxHQUFHLEVBQUUsbUJBQW1CO2lCQUN6QjthQUNGLENBQUMsQ0FBQztZQUNILHFCQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLHFCQUFxQixDQUFDLCtCQUErQixFQUFFO2dCQUMvRSxLQUFLLEVBQUU7b0JBQ0wsR0FBRyxFQUFFLG1CQUFtQjtpQkFDekI7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7WUFDN0IsUUFBUTtZQUNSLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQzFCLE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNqQyxNQUFNLFNBQVMsR0FBeUIsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxlQUFlLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUM1RyxNQUFNLE1BQU0sR0FBc0IsSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztZQUU3RSxPQUFPO1lBQ1AsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxpQkFBaUIsRUFBRSxhQUFhLEVBQUUsQ0FBQyxDQUFDO1lBRWxFLE9BQU87WUFDUCxNQUFNLFFBQVEsR0FBRyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxRQUFRLENBQUM7WUFDdEUsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDO2lCQUNsRCxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUUsQ0FBUyxDQUFDLElBQUksS0FBSywrQkFBK0IsQ0FBQztpQkFDdkUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUNqRCxRQUFRO1lBQ1IsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDMUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUM3QyxNQUFNLFNBQVMsR0FBRyxJQUFJLFVBQVUsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLGVBQWUsQ0FBQyxDQUFDO1lBQ25FLE1BQU0sT0FBTyxHQUFHLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsY0FBYyxFQUFFO2dCQUMzRCxVQUFVLEVBQUUsY0FBYzthQUMzQixDQUFDLENBQUM7WUFDSCxNQUFNLE9BQU8sR0FBRyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLGNBQWMsRUFBRTtnQkFDM0QsVUFBVSxFQUFFLGNBQWM7YUFDM0IsQ0FBQyxDQUFDO1lBRUgsT0FBTztZQUNQLFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDN0IsU0FBUyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUU3QixPQUFPO1lBQ1AsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsUUFBUSxDQUFDO1lBQ3RFLE1BQU0sVUFBVSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQztpQkFDbEQsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFFLENBQVMsQ0FBQyxJQUFJLEtBQUssK0JBQStCLENBQUM7aUJBQ3ZFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV0QixNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUN6QixpRUFBaUU7Z0JBQ2pFLGlFQUFpRTthQUNsRSxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gJ0Bhd3MtY2RrL2Fzc2VydGlvbnMnO1xuaW1wb3J0ICogYXMgY2RrIGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0ICogYXMgYXBpZ2F0ZXdheSBmcm9tICcuLi9saWInO1xuXG5jb25zdCBSRVNPVVJDRV9UWVBFID0gJ0FXUzo6QXBpR2F0ZXdheTo6VXNhZ2VQbGFuJztcbmRlc2NyaWJlKCd1c2FnZSBwbGFuJywgKCkgPT4ge1xuICB0ZXN0KCdkZWZhdWx0IHNldHVwJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgY29uc3QgYXBpID0gbmV3IGFwaWdhdGV3YXkuUmVzdEFwaShzdGFjaywgJ215LWFwaScsIHsgY2xvdWRXYXRjaFJvbGU6IGZhbHNlLCBkZXBsb3k6IGZhbHNlIH0pO1xuICAgIGFwaS5yb290LmFkZE1ldGhvZCgnR0VUJyk7IC8vIE5lZWQgYXQgbGVhc3Qgb25lIG1ldGhvZCBvbiB0aGUgYXBpXG4gICAgY29uc3QgdXNhZ2VQbGFuTmFtZSA9ICdQcm8nO1xuICAgIGNvbnN0IHVzYWdlUGxhbkRlc2NyaXB0aW9uID0gJ1BybyBVc2FnZSBQbGFuIHdpdGggbm8gdGhyb3R0bGluZyBsaW1pdHMnO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBhcGlnYXRld2F5LlVzYWdlUGxhbihzdGFjaywgJ215LXVzYWdlLXBsYW4nLCB7XG4gICAgICBuYW1lOiB1c2FnZVBsYW5OYW1lLFxuICAgICAgZGVzY3JpcHRpb246IHVzYWdlUGxhbkRlc2NyaXB0aW9uLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKFJFU09VUkNFX1RZUEUsIHtcbiAgICAgIFVzYWdlUGxhbk5hbWU6IHVzYWdlUGxhbk5hbWUsXG4gICAgICBEZXNjcmlwdGlvbjogdXNhZ2VQbGFuRGVzY3JpcHRpb24sXG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3VzYWdlIHBsYW4gd2l0aCBpbnRlZ2VyIHRocm90dGxpbmcgbGltaXRzJywgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgY29uc3QgYXBpID0gbmV3IGFwaWdhdGV3YXkuUmVzdEFwaShzdGFjaywgJ215LWFwaScsIHsgY2xvdWRXYXRjaFJvbGU6IGZhbHNlLCBkZXBsb3k6IHRydWUsIGRlcGxveU9wdGlvbnM6IHsgc3RhZ2VOYW1lOiAndGVzdCcgfSB9KTtcbiAgICBjb25zdCBtZXRob2Q6IGFwaWdhdGV3YXkuTWV0aG9kID0gYXBpLnJvb3QuYWRkTWV0aG9kKCdHRVQnKTsgLy8gTmVlZCBhdCBsZWFzdCBvbmUgbWV0aG9kIG9uIHRoZSBhcGlcbiAgICBjb25zdCB1c2FnZVBsYW5OYW1lID0gJ0Jhc2ljJztcbiAgICBjb25zdCB1c2FnZVBsYW5EZXNjcmlwdGlvbiA9ICdCYXNpYyBVc2FnZSBQbGFuIHdpdGggaW50ZWdlciB0aHJvdHRsaW5nIGxpbWl0cyc7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IGFwaWdhdGV3YXkuVXNhZ2VQbGFuKHN0YWNrLCAnbXktdXNhZ2UtcGxhbicsIHtcbiAgICAgIG5hbWU6IHVzYWdlUGxhbk5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogdXNhZ2VQbGFuRGVzY3JpcHRpb24sXG4gICAgICBhcGlTdGFnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHN0YWdlOiBhcGkuZGVwbG95bWVudFN0YWdlLFxuICAgICAgICAgIHRocm90dGxlOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICAgICAgdGhyb3R0bGU6IHtcbiAgICAgICAgICAgICAgICBidXJzdExpbWl0OiAyMCxcbiAgICAgICAgICAgICAgICByYXRlTGltaXQ6IDEwLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcyhSRVNPVVJDRV9UWVBFLCB7XG4gICAgICBVc2FnZVBsYW5OYW1lOiB1c2FnZVBsYW5OYW1lLFxuICAgICAgRGVzY3JpcHRpb246IHVzYWdlUGxhbkRlc2NyaXB0aW9uLFxuICAgICAgQXBpU3RhZ2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBBcGlJZDoge1xuICAgICAgICAgICAgUmVmOiAnbXlhcGk0QzdCRjE4NicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBTdGFnZToge1xuICAgICAgICAgICAgUmVmOiAnbXlhcGlEZXBsb3ltZW50U3RhZ2V0ZXN0NEE0QUI2NUUnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgVGhyb3R0bGU6IHtcbiAgICAgICAgICAgICcvL0dFVCc6IHtcbiAgICAgICAgICAgICAgQnVyc3RMaW1pdDogMjAsXG4gICAgICAgICAgICAgIFJhdGVMaW1pdDogMTAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCd1c2FnZSBwbGFuIHdpdGggaW50ZWdlciBhbmQgZmxvYXQgdGhyb3R0bGluZyBsaW1pdHMnLCAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICBjb25zdCBhcGkgPSBuZXcgYXBpZ2F0ZXdheS5SZXN0QXBpKHN0YWNrLCAnbXktYXBpJywgeyBjbG91ZFdhdGNoUm9sZTogZmFsc2UsIGRlcGxveTogdHJ1ZSwgZGVwbG95T3B0aW9uczogeyBzdGFnZU5hbWU6ICd0ZXN0JyB9IH0pO1xuICAgIGNvbnN0IG1ldGhvZDogYXBpZ2F0ZXdheS5NZXRob2QgPSBhcGkucm9vdC5hZGRNZXRob2QoJ0dFVCcpOyAvLyBOZWVkIGF0IGxlYXN0IG9uZSBtZXRob2Qgb24gdGhlIGFwaVxuICAgIGNvbnN0IHVzYWdlUGxhbk5hbWUgPSAnQmFzaWMnO1xuICAgIGNvbnN0IHVzYWdlUGxhbkRlc2NyaXB0aW9uID0gJ0Jhc2ljIFVzYWdlIFBsYW4gd2l0aCBpbnRlZ2VyIGFuZCBmbG9hdCB0aHJvdHRsaW5nIGxpbWl0cyc7XG5cbiAgICAvLyBXSEVOXG4gICAgbmV3IGFwaWdhdGV3YXkuVXNhZ2VQbGFuKHN0YWNrLCAnbXktdXNhZ2UtcGxhbicsIHtcbiAgICAgIG5hbWU6IHVzYWdlUGxhbk5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogdXNhZ2VQbGFuRGVzY3JpcHRpb24sXG4gICAgICBhcGlTdGFnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHN0YWdlOiBhcGkuZGVwbG95bWVudFN0YWdlLFxuICAgICAgICAgIHRocm90dGxlOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1ldGhvZCxcbiAgICAgICAgICAgICAgdGhyb3R0bGU6IHtcbiAgICAgICAgICAgICAgICBidXJzdExpbWl0OiAyMCxcbiAgICAgICAgICAgICAgICByYXRlTGltaXQ6IDEwLjUsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKFJFU09VUkNFX1RZUEUsIHtcbiAgICAgIFVzYWdlUGxhbk5hbWU6IHVzYWdlUGxhbk5hbWUsXG4gICAgICBEZXNjcmlwdGlvbjogdXNhZ2VQbGFuRGVzY3JpcHRpb24sXG4gICAgICBBcGlTdGFnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIEFwaUlkOiB7XG4gICAgICAgICAgICBSZWY6ICdteWFwaTRDN0JGMTg2JyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFN0YWdlOiB7XG4gICAgICAgICAgICBSZWY6ICdteWFwaURlcGxveW1lbnRTdGFnZXRlc3Q0QTRBQjY1RScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBUaHJvdHRsZToge1xuICAgICAgICAgICAgJy8vR0VUJzoge1xuICAgICAgICAgICAgICBCdXJzdExpbWl0OiAyMCxcbiAgICAgICAgICAgICAgUmF0ZUxpbWl0OiAxMC41LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgndXNhZ2UgcGxhbiB3aXRoIGJsb2NrZWQgbWV0aG9kcycsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuICAgIGNvbnN0IGFwaSA9IG5ldyBhcGlnYXRld2F5LlJlc3RBcGkoc3RhY2ssICdteS1hcGknLCB7IGNsb3VkV2F0Y2hSb2xlOiBmYWxzZSwgZGVwbG95OiB0cnVlLCBkZXBsb3lPcHRpb25zOiB7IHN0YWdlTmFtZTogJ3Rlc3QnIH0gfSk7XG4gICAgY29uc3QgbWV0aG9kOiBhcGlnYXRld2F5Lk1ldGhvZCA9IGFwaS5yb290LmFkZE1ldGhvZCgnR0VUJyk7IC8vIE5lZWQgYXQgbGVhc3Qgb25lIG1ldGhvZCBvbiB0aGUgYXBpXG4gICAgY29uc3QgdXNhZ2VQbGFuTmFtZSA9ICdCYXNpYyc7XG4gICAgY29uc3QgdXNhZ2VQbGFuRGVzY3JpcHRpb24gPSAnQmFzaWMgVXNhZ2UgUGxhbiB3aXRoIHRocm90dGxpbmcgbGltaXRzJztcblxuICAgIC8vIFdIRU5cbiAgICBuZXcgYXBpZ2F0ZXdheS5Vc2FnZVBsYW4oc3RhY2ssICdteS11c2FnZS1wbGFuJywge1xuICAgICAgbmFtZTogdXNhZ2VQbGFuTmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiB1c2FnZVBsYW5EZXNjcmlwdGlvbixcbiAgICAgIGFwaVN0YWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgc3RhZ2U6IGFwaS5kZXBsb3ltZW50U3RhZ2UsXG4gICAgICAgICAgdGhyb3R0bGU6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbWV0aG9kLFxuICAgICAgICAgICAgICB0aHJvdHRsZToge1xuICAgICAgICAgICAgICAgIGJ1cnN0TGltaXQ6IDAsXG4gICAgICAgICAgICAgICAgcmF0ZUxpbWl0OiAwLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIC8vIFRIRU5cbiAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcyhSRVNPVVJDRV9UWVBFLCB7XG4gICAgICBVc2FnZVBsYW5OYW1lOiB1c2FnZVBsYW5OYW1lLFxuICAgICAgRGVzY3JpcHRpb246IHVzYWdlUGxhbkRlc2NyaXB0aW9uLFxuICAgICAgQXBpU3RhZ2VzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBBcGlJZDoge1xuICAgICAgICAgICAgUmVmOiAnbXlhcGk0QzdCRjE4NicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBTdGFnZToge1xuICAgICAgICAgICAgUmVmOiAnbXlhcGlEZXBsb3ltZW50U3RhZ2V0ZXN0NEE0QUI2NUUnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgVGhyb3R0bGU6IHtcbiAgICAgICAgICAgICcvL0dFVCc6IHtcbiAgICAgICAgICAgICAgQnVyc3RMaW1pdDogMCxcbiAgICAgICAgICAgICAgUmF0ZUxpbWl0OiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgdGVzdCgndXNhZ2UgcGxhbiB3aXRoIHF1b3RhIGxpbWl0cycsICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjaygpO1xuXG4gICAgLy8gV0hFTlxuICAgIG5ldyBhcGlnYXRld2F5LlVzYWdlUGxhbihzdGFjaywgJ215LXVzYWdlLXBsYW4nLCB7XG4gICAgICBxdW90YToge1xuICAgICAgICBsaW1pdDogMTAwMDAsXG4gICAgICAgIHBlcmlvZDogYXBpZ2F0ZXdheS5QZXJpb2QuTU9OVEgsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gVEhFTlxuICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKFJFU09VUkNFX1RZUEUsIHtcbiAgICAgIFF1b3RhOiB7XG4gICAgICAgIExpbWl0OiAxMDAwMCxcbiAgICAgICAgUGVyaW9kOiAnTU9OVEgnLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1VzYWdlUGxhbktleScsICgpID0+IHtcblxuICAgIHRlc3QoJ2RlZmF1bHQnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgICBjb25zdCB1c2FnZVBsYW46IGFwaWdhdGV3YXkuVXNhZ2VQbGFuID0gbmV3IGFwaWdhdGV3YXkuVXNhZ2VQbGFuKHN0YWNrLCAnbXktdXNhZ2UtcGxhbicsIHtcbiAgICAgICAgbmFtZTogJ0Jhc2ljJyxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgYXBpS2V5OiBhcGlnYXRld2F5LkFwaUtleSA9IG5ldyBhcGlnYXRld2F5LkFwaUtleShzdGFjaywgJ215LWFwaS1rZXknKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgdXNhZ2VQbGFuLmFkZEFwaUtleShhcGlLZXkpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpBcGlHYXRld2F5OjpVc2FnZVBsYW5LZXknLCB7XG4gICAgICAgIEtleUlkOiB7XG4gICAgICAgICAgUmVmOiAnbXlhcGlrZXkxQjA1MkY3MCcsXG4gICAgICAgIH0sXG4gICAgICAgIEtleVR5cGU6ICdBUElfS0VZJyxcbiAgICAgICAgVXNhZ2VQbGFuSWQ6IHtcbiAgICAgICAgICBSZWY6ICdteXVzYWdlcGxhbjIzQUExRTMyJyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG5cbiAgICB0ZXN0KCdpbXBvcnRlZCcsICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soKTtcbiAgICAgIGNvbnN0IHVzYWdlUGxhbjogYXBpZ2F0ZXdheS5JVXNhZ2VQbGFuID0gYXBpZ2F0ZXdheS5Vc2FnZVBsYW4uZnJvbVVzYWdlUGxhbklkKHN0YWNrLCAnbXktdXNhZ2UtcGxhbicsICdpbXBvcnRlZC1pZCcpO1xuICAgICAgY29uc3QgYXBpS2V5OiBhcGlnYXRld2F5LkFwaUtleSA9IG5ldyBhcGlnYXRld2F5LkFwaUtleShzdGFjaywgJ215LWFwaS1rZXknKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgdXNhZ2VQbGFuLmFkZEFwaUtleShhcGlLZXkpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpBcGlHYXRld2F5OjpVc2FnZVBsYW5LZXknLCB7XG4gICAgICAgIEtleUlkOiB7XG4gICAgICAgICAgUmVmOiAnbXlhcGlrZXkxQjA1MkY3MCcsXG4gICAgICAgIH0sXG4gICAgICAgIEtleVR5cGU6ICdBUElfS0VZJyxcbiAgICAgICAgVXNhZ2VQbGFuSWQ6ICdpbXBvcnRlZC1pZCcsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ211bHRpcGxlIGtleXMnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3Qgc3RhY2sgPSBuZXcgY2RrLlN0YWNrKCk7XG4gICAgICBjb25zdCB1c2FnZVBsYW4gPSBuZXcgYXBpZ2F0ZXdheS5Vc2FnZVBsYW4oc3RhY2ssICdteS11c2FnZS1wbGFuJyk7XG4gICAgICBjb25zdCBhcGlLZXkxID0gbmV3IGFwaWdhdGV3YXkuQXBpS2V5KHN0YWNrLCAnbXktYXBpLWtleS0xJywge1xuICAgICAgICBhcGlLZXlOYW1lOiAnbXktYXBpLWtleS0xJyxcbiAgICAgIH0pO1xuICAgICAgY29uc3QgYXBpS2V5MiA9IG5ldyBhcGlnYXRld2F5LkFwaUtleShzdGFjaywgJ215LWFwaS1rZXktMicsIHtcbiAgICAgICAgYXBpS2V5TmFtZTogJ215LWFwaS1rZXktMicsXG4gICAgICB9KTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgdXNhZ2VQbGFuLmFkZEFwaUtleShhcGlLZXkxKTtcbiAgICAgIHVzYWdlUGxhbi5hZGRBcGlLZXkoYXBpS2V5Mik7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkFwaUdhdGV3YXk6OkFwaUtleScsIHtcbiAgICAgICAgTmFtZTogJ215LWFwaS1rZXktMScsXG4gICAgICB9KTtcbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkFwaUdhdGV3YXk6OkFwaUtleScsIHtcbiAgICAgICAgTmFtZTogJ215LWFwaS1rZXktMicsXG4gICAgICB9KTtcbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkFwaUdhdGV3YXk6OlVzYWdlUGxhbktleScsIHtcbiAgICAgICAgS2V5SWQ6IHtcbiAgICAgICAgICBSZWY6ICdteWFwaWtleTExRjcyM0ZDNycsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIFRlbXBsYXRlLmZyb21TdGFjayhzdGFjaykuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkFwaUdhdGV3YXk6OlVzYWdlUGxhbktleScsIHtcbiAgICAgICAgS2V5SWQ6IHtcbiAgICAgICAgICBSZWY6ICdteWFwaWtleTJBQkRFRjAxMicsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ292ZXJyaWRlTG9naWNhbElkJywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IGFwcCA9IG5ldyBjZGsuQXBwKCk7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBjZGsuU3RhY2soYXBwKTtcbiAgICAgIGNvbnN0IHVzYWdlUGxhbjogYXBpZ2F0ZXdheS5Vc2FnZVBsYW4gPSBuZXcgYXBpZ2F0ZXdheS5Vc2FnZVBsYW4oc3RhY2ssICdteS11c2FnZS1wbGFuJywgeyBuYW1lOiAnQmFzaWMnIH0pO1xuICAgICAgY29uc3QgYXBpS2V5OiBhcGlnYXRld2F5LkFwaUtleSA9IG5ldyBhcGlnYXRld2F5LkFwaUtleShzdGFjaywgJ215LWFwaS1rZXknKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgdXNhZ2VQbGFuLmFkZEFwaUtleShhcGlLZXksIHsgb3ZlcnJpZGVMb2dpY2FsSWQ6ICdteWxvZ2ljYWxpZCcgfSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGNvbnN0IHRlbXBsYXRlID0gYXBwLnN5bnRoKCkuZ2V0U3RhY2tCeU5hbWUoc3RhY2suc3RhY2tOYW1lKS50ZW1wbGF0ZTtcbiAgICAgIGNvbnN0IGxvZ2ljYWxJZHMgPSBPYmplY3QuZW50cmllcyh0ZW1wbGF0ZS5SZXNvdXJjZXMpXG4gICAgICAgIC5maWx0ZXIoKFtfLCB2XSkgPT4gKHYgYXMgYW55KS5UeXBlID09PSAnQVdTOjpBcGlHYXRld2F5OjpVc2FnZVBsYW5LZXknKVxuICAgICAgICAubWFwKChbaywgX10pID0+IGspO1xuICAgICAgZXhwZWN0KGxvZ2ljYWxJZHMpLnRvRXF1YWwoWydteWxvZ2ljYWxpZCddKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ1VzYWdlUGxhbktleXMgaGF2ZSB1bmlxdWUgbG9naWNhbCBpZHMnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3QgYXBwID0gbmV3IGNkay5BcHAoKTtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdteS1zdGFjaycpO1xuICAgICAgY29uc3QgdXNhZ2VQbGFuID0gbmV3IGFwaWdhdGV3YXkuVXNhZ2VQbGFuKHN0YWNrLCAnbXktdXNhZ2UtcGxhbicpO1xuICAgICAgY29uc3QgYXBpS2V5MSA9IG5ldyBhcGlnYXRld2F5LkFwaUtleShzdGFjaywgJ215LWFwaS1rZXktMScsIHtcbiAgICAgICAgYXBpS2V5TmFtZTogJ215LWFwaS1rZXktMScsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGFwaUtleTIgPSBuZXcgYXBpZ2F0ZXdheS5BcGlLZXkoc3RhY2ssICdteS1hcGkta2V5LTInLCB7XG4gICAgICAgIGFwaUtleU5hbWU6ICdteS1hcGkta2V5LTInLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFdIRU5cbiAgICAgIHVzYWdlUGxhbi5hZGRBcGlLZXkoYXBpS2V5MSk7XG4gICAgICB1c2FnZVBsYW4uYWRkQXBpS2V5KGFwaUtleTIpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBjb25zdCB0ZW1wbGF0ZSA9IGFwcC5zeW50aCgpLmdldFN0YWNrQnlOYW1lKHN0YWNrLnN0YWNrTmFtZSkudGVtcGxhdGU7XG4gICAgICBjb25zdCBsb2dpY2FsSWRzID0gT2JqZWN0LmVudHJpZXModGVtcGxhdGUuUmVzb3VyY2VzKVxuICAgICAgICAuZmlsdGVyKChbXywgdl0pID0+ICh2IGFzIGFueSkuVHlwZSA9PT0gJ0FXUzo6QXBpR2F0ZXdheTo6VXNhZ2VQbGFuS2V5JylcbiAgICAgICAgLm1hcCgoW2ssIF9dKSA9PiBrKTtcblxuICAgICAgZXhwZWN0KGxvZ2ljYWxJZHMpLnRvRXF1YWwoW1xuICAgICAgICAnbXl1c2FnZXBsYW5Vc2FnZVBsYW5LZXlSZXNvdXJjZW15c3RhY2tteWFwaWtleTFFRTlBQTFCMzU5MTIxMjc0JyxcbiAgICAgICAgJ215dXNhZ2VwbGFuVXNhZ2VQbGFuS2V5UmVzb3VyY2VteXN0YWNrbXlhcGlrZXkyQjRFOEVCMTQ1NkRDODhFOScsXG4gICAgICBdKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==