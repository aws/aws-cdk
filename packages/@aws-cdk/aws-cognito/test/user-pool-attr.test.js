"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@aws-cdk/core");
const lib_1 = require("../lib");
const attr_names_1 = require("../lib/private/attr-names");
describe('User Pool Attributes', () => {
    describe('mutable', () => {
        test('default', () => {
            // GIVEN
            const allAttributes = [
                new lib_1.StringAttribute(),
                new lib_1.NumberAttribute(),
                new lib_1.BooleanAttribute(),
                new lib_1.DateTimeAttribute(),
            ];
            // WHEN
            const bounds = allAttributes.map((attr) => attr.bind());
            // THEN
            bounds.forEach((bound) => {
                expect(bound.mutable).toBeUndefined();
            });
        });
        describe('mutable is set to true when specified', () => {
            // GIVEN
            const allTrueProps = {
                mutable: true,
            };
            const allAttributeTypes = [
                new lib_1.StringAttribute(allTrueProps),
                new lib_1.NumberAttribute(allTrueProps),
                new lib_1.BooleanAttribute(allTrueProps),
                new lib_1.DateTimeAttribute(allTrueProps),
            ];
            // WHEN
            const bounds = allAttributeTypes.map((attr) => attr.bind());
            // THEN
            bounds.forEach((bound) => {
                test(`in attribute of type ${bound.dataType}:`, () => {
                    expect(bound.mutable).toEqual(true);
                });
            });
        });
        describe('mutable is set to false', () => {
            // GIVEN
            const allFalseProps = {
                mutable: false,
            };
            const allAttributeTypes = [
                new lib_1.StringAttribute(allFalseProps),
                new lib_1.NumberAttribute(allFalseProps),
                new lib_1.BooleanAttribute(allFalseProps),
                new lib_1.DateTimeAttribute(allFalseProps),
            ];
            // WHEN
            const bounds = allAttributeTypes.map((attr) => attr.bind());
            // THEN
            bounds.forEach((bound) => {
                test(`in attribute of type ${bound.dataType}`, () => {
                    expect(bound.mutable).toEqual(false);
                });
            });
        });
    });
    describe('StringAttribute', () => {
        test('default', () => {
            // GIVEN
            const attr = new lib_1.StringAttribute();
            // WHEN
            const bound = attr.bind();
            // THEN
            expect(bound.dataType).toEqual('String');
            expect(bound.stringConstraints).toBeUndefined();
            expect(bound.numberConstraints).toBeUndefined();
        });
        test('specified constraints are recognized', () => {
            // GIVEN
            const attr = new lib_1.StringAttribute({ minLen: 10, maxLen: 60 });
            // WHEN
            const bound = attr.bind();
            // THEN
            expect(bound.stringConstraints).toEqual({
                minLen: 10,
                maxLen: 60,
            });
            expect(bound.numberConstraints).toBeUndefined();
        });
        test('throws error when crossing limits', () => {
            expect(() => new lib_1.StringAttribute({ minLen: -10 }))
                .toThrow(/minLen cannot be less than/);
            expect(() => new lib_1.StringAttribute({ maxLen: 5000 }))
                .toThrow(/maxLen cannot be greater than/);
        });
        test('validation is skipped when minLen or maxLen are tokens', () => {
            const stack = new core_1.Stack();
            const parameter = new core_1.CfnParameter(stack, 'Parameter', {
                type: 'Number',
            });
            expect(() => new lib_1.StringAttribute({ minLen: parameter.valueAsNumber }))
                .not.toThrow();
            expect(() => new lib_1.StringAttribute({ maxLen: parameter.valueAsNumber }))
                .not.toThrow();
        });
    });
    describe('NumberAttribute', () => {
        test('default', () => {
            // GIVEN
            const attr = new lib_1.NumberAttribute();
            // WHEN
            const bound = attr.bind();
            // THEN
            expect(bound.dataType).toEqual('Number');
            expect(bound.stringConstraints).toBeUndefined();
            expect(bound.numberConstraints).toBeUndefined();
        });
        test('specified constraints are recognized', () => {
            // GIVEN
            const attr = new lib_1.NumberAttribute({ min: 5, max: 600 });
            // WHEN
            const bound = attr.bind();
            // THEN
            expect(bound.numberConstraints).toEqual({
                min: 5,
                max: 600,
            });
            expect(bound.stringConstraints).toBeUndefined();
        });
    });
    describe('BooleanAttribute', () => {
        test('default', () => {
            // GIVEN
            const attr = new lib_1.BooleanAttribute();
            // WHEN
            const bound = attr.bind();
            // THEN
            expect(bound.dataType).toEqual('Boolean');
            expect(bound.stringConstraints).toBeUndefined();
            expect(bound.numberConstraints).toBeUndefined();
        });
    });
    describe('DateTimeAttribute', () => {
        test('default', () => {
            // GIVEN
            const attr = new lib_1.DateTimeAttribute();
            // WHEN
            const bound = attr.bind();
            // THEN
            expect(bound.dataType).toEqual('DateTime');
            expect(bound.stringConstraints).toBeUndefined();
            expect(bound.numberConstraints).toBeUndefined();
        });
    });
    describe('ClientAttributes', () => {
        test('create empty ClientAttributes', () => {
            // WHEN
            const clientAttributes = (new lib_1.ClientAttributes());
            // THEN
            expect(clientAttributes.attributes()).toStrictEqual([]);
        });
        test('create ClientAttributes with all standard attributes', () => {
            // GIVEN
            const customAttributes = ['custom:my_attribute'];
            // WHEN
            const clientAttributes = (new lib_1.ClientAttributes()).withStandardAttributes({
                address: true,
                birthdate: true,
                email: true,
                emailVerified: true,
                familyName: true,
                fullname: true,
                gender: true,
                givenName: true,
                lastUpdateTime: true,
                locale: true,
                middleName: true,
                nickname: true,
                phoneNumber: true,
                phoneNumberVerified: true,
                preferredUsername: true,
                profilePage: true,
                profilePicture: true,
                timezone: true,
                website: true,
            }).withCustomAttributes(...customAttributes);
            const attributes = clientAttributes.attributes();
            // THEN
            expect(attributes.length).toEqual(20);
            expect(attributes).toContain('preferred_username');
            expect(attributes).toContain('email_verified');
            expect(attributes).toContain('phone_number_verified');
            expect(attributes).toContain('custom:my_attribute');
        });
        test('create ClientAttributes copying another one', () => {
            // GIVEN
            const original = (new lib_1.ClientAttributes())
                .withStandardAttributes({ email: true })
                .withCustomAttributes('custom1');
            const copied = original
                .withStandardAttributes({ emailVerified: true })
                .withCustomAttributes('custom2');
            // WHEN
            const originalAttributes = original.attributes();
            const copiedAttributes = copied.attributes();
            // THEN
            expect(originalAttributes.length).toEqual(2);
            expect(copiedAttributes.length).toEqual(4);
            // originals MUST NOT contain the added ones
            expect(originalAttributes).toContain('email');
            expect(originalAttributes).toContain('custom:custom1');
            expect(originalAttributes).not.toContain('email_verified');
            expect(originalAttributes).not.toContain('custom:custom2');
            // copied MUST contain all attributes
            expect(copiedAttributes).toContain('email');
            expect(copiedAttributes).toContain('custom:custom1');
            expect(copiedAttributes).toContain('email_verified');
            expect(copiedAttributes).toContain('custom:custom2');
        });
        test('create ClientAttributes with custom attributes only', () => {
            // GIVEN
            const customAttributes = ['custom:my_first', 'my_second'];
            // WHEN
            const clientAttributes = (new lib_1.ClientAttributes()).withCustomAttributes(...customAttributes);
            const attributes = clientAttributes.attributes();
            // EXPECT
            expect(attributes.length).toEqual(2);
            expect(attributes).toContain('custom:my_first');
            expect(attributes).toContain('custom:my_second');
        });
        test('create ClientAttributes with all StandardAttributeNames', () => {
            // this test is intended to check if changes in the `StandardAttributeNames` constant
            // does not reflect as changes in the `StandardAttributesMask`
            // GIVEN
            let allStandardAttributes = {};
            let standardAttributeNamesCount = 0; // the count of StandardAttributeNames
            // iterate through the standard attribute names
            for (const attributeKey in attr_names_1.StandardAttributeNames) {
                standardAttributeNamesCount += 1;
                expect(attr_names_1.StandardAttributeNames).toHaveProperty(attributeKey);
                // add the standard attribute
                allStandardAttributes[attributeKey] = true;
            }
            // WHEN
            const attributes = (new lib_1.ClientAttributes()).withStandardAttributes(allStandardAttributes).attributes();
            // EXPECT
            expect(attributes.length).toEqual(standardAttributeNamesCount);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlci1wb29sLWF0dHIudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVzZXItcG9vbC1hdHRyLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx3Q0FBb0Q7QUFDcEQsZ0NBQTBKO0FBQzFKLDBEQUFtRTtBQUVuRSxRQUFRLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO0lBRXBDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO1FBQ3ZCLElBQUksQ0FBQyxTQUFTLEVBQUUsR0FBRyxFQUFFO1lBQ25CLFFBQVE7WUFDUixNQUFNLGFBQWEsR0FBdUI7Z0JBQ3hDLElBQUkscUJBQWUsRUFBRTtnQkFDckIsSUFBSSxxQkFBZSxFQUFFO2dCQUNyQixJQUFJLHNCQUFnQixFQUFFO2dCQUN0QixJQUFJLHVCQUFpQixFQUFFO2FBQ3hCLENBQUM7WUFFRixPQUFPO1lBQ1AsTUFBTSxNQUFNLEdBQTRCLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBRSxDQUFDO1lBRWxGLE9BQU87WUFDUCxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7Z0JBQ3ZCLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDeEMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILFFBQVEsQ0FBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7WUFDckQsUUFBUTtZQUNSLE1BQU0sWUFBWSxHQUFHO2dCQUNuQixPQUFPLEVBQUUsSUFBSTthQUNkLENBQUM7WUFDRixNQUFNLGlCQUFpQixHQUF1QjtnQkFDNUMsSUFBSSxxQkFBZSxDQUFDLFlBQVksQ0FBQztnQkFDakMsSUFBSSxxQkFBZSxDQUFDLFlBQVksQ0FBQztnQkFDakMsSUFBSSxzQkFBZ0IsQ0FBQyxZQUFZLENBQUM7Z0JBQ2xDLElB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QixFQUFFO2dCQUNqRCwyQkFBMkIsSUFBSSxDQUFDLENBQUM7Z0JBQ2pDLE1BQU0sQ0FBQyxtQ0FBc0IsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDNUQsNkJBQTZCO2dCQUM3QixxQkFBcUIsQ0FBQyxZQUFZLENBQUMsR0FBRyxJQUFJLENBQUM7YUFDNUM7WUFFRCxPQUFPO1lBQ1AsTUFBTSxVQUFVLEdBQUcsQ0FBQyxJQUFJLHNCQUFnQixFQUFFLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBRXZHLFNBQVM7WUFDVCxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQ2pFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENmblBhcmFtZXRlciwgU3RhY2sgfSBmcm9tICdAYXdzLWNkay9jb3JlJztcbmltcG9ydCB7IEJvb2xlYW5BdHRyaWJ1dGUsIEN1c3RvbUF0dHJpYnV0ZUNvbmZpZywgRGF0ZVRpbWVBdHRyaWJ1dGUsIElDdXN0b21BdHRyaWJ1dGUsIE51bWJlckF0dHJpYnV0ZSwgU3RyaW5nQXR0cmlidXRlLCBDbGllbnRBdHRyaWJ1dGVzIH0gZnJvbSAnLi4vbGliJztcbmltcG9ydCB7IFN0YW5kYXJkQXR0cmlidXRlTmFtZXMgfSBmcm9tICcuLi9saWIvcHJpdmF0ZS9hdHRyLW5hbWVzJztcblxuZGVzY3JpYmUoJ1VzZXIgUG9vbCBBdHRyaWJ1dGVzJywgKCkgPT4ge1xuXG4gIGRlc2NyaWJlKCdtdXRhYmxlJywgKCkgPT4ge1xuICAgIHRlc3QoJ2RlZmF1bHQnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3QgYWxsQXR0cmlidXRlczogSUN1c3RvbUF0dHJpYnV0ZVtdID0gW1xuICAgICAgICBuZXcgU3RyaW5nQXR0cmlidXRlKCksXG4gICAgICAgIG5ldyBOdW1iZXJBdHRyaWJ1dGUoKSxcbiAgICAgICAgbmV3IEJvb2xlYW5BdHRyaWJ1dGUoKSxcbiAgICAgICAgbmV3IERhdGVUaW1lQXR0cmlidXRlKCksXG4gICAgICBdO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBib3VuZHM6IEN1c3RvbUF0dHJpYnV0ZUNvbmZpZ1tdID0gYWxsQXR0cmlidXRlcy5tYXAoKGF0dHIpID0+IGF0dHIuYmluZCgpICk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGJvdW5kcy5mb3JFYWNoKChib3VuZCkgPT4ge1xuICAgICAgICBleHBlY3QoYm91bmQubXV0YWJsZSkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnbXV0YWJsZSBpcyBzZXQgdG8gdHJ1ZSB3aGVuIHNwZWNpZmllZCcsICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBjb25zdCBhbGxUcnVlUHJvcHMgPSB7XG4gICAgICAgIG11dGFibGU6IHRydWUsXG4gICAgICB9O1xuICAgICAgY29uc3QgYWxsQXR0cmlidXRlVHlwZXM6IElDdXN0b21BdHRyaWJ1dGVbXSA9IFtcbiAgICAgICAgbmV3IFN0cmluZ0F0dHJpYnV0ZShhbGxUcnVlUHJvcHMpLFxuICAgICAgICBuZXcgTnVtYmVyQXR0cmlidXRlKGFsbFRydWVQcm9wcyksXG4gICAgICAgIG5ldyBCb29sZWFuQXR0cmlidXRlKGFsbFRydWVQcm9wcyksXG4gICAgICAgIG5ldyBEYXRlVGltZUF0dHJpYnV0ZShhbGxUcnVlUHJvcHMpLFxuICAgICAgXTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgYm91bmRzOiBDdXN0b21BdHRyaWJ1dGVDb25maWdbXSA9IGFsbEF0dHJpYnV0ZVR5cGVzLm1hcCgoYXR0cikgPT4gYXR0ci5iaW5kKCkgKTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgYm91bmRzLmZvckVhY2goKGJvdW5kKSA9PiB7XG4gICAgICAgIHRlc3QoYGluIGF0dHJpYnV0ZSBvZiB0eXBlICR7Ym91bmQuZGF0YVR5cGV9OmAsICgpID0+IHtcbiAgICAgICAgICBleHBlY3QoYm91bmQubXV0YWJsZSkudG9FcXVhbCh0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdtdXRhYmxlIGlzIHNldCB0byBmYWxzZScsICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBjb25zdCBhbGxGYWxzZVByb3BzID0ge1xuICAgICAgICBtdXRhYmxlOiBmYWxzZSxcbiAgICAgIH07XG4gICAgICBjb25zdCBhbGxBdHRyaWJ1dGVUeXBlczogSUN1c3RvbUF0dHJpYnV0ZVtdID0gW1xuICAgICAgICBuZXcgU3RyaW5nQXR0cmlidXRlKGFsbEZhbHNlUHJvcHMpLFxuICAgICAgICBuZXcgTnVtYmVyQXR0cmlidXRlKGFsbEZhbHNlUHJvcHMpLFxuICAgICAgICBuZXcgQm9vbGVhbkF0dHJpYnV0ZShhbGxGYWxzZVByb3BzKSxcbiAgICAgICAgbmV3IERhdGVUaW1lQXR0cmlidXRlKGFsbEZhbHNlUHJvcHMpLFxuICAgICAgXTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgYm91bmRzOiBDdXN0b21BdHRyaWJ1dGVDb25maWdbXSA9IGFsbEF0dHJpYnV0ZVR5cGVzLm1hcCgoYXR0cikgPT4gYXR0ci5iaW5kKCkgKTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgYm91bmRzLmZvckVhY2goKGJvdW5kKSA9PiB7XG4gICAgICAgIHRlc3QoYGluIGF0dHJpYnV0ZSBvZiB0eXBlICR7Ym91bmQuZGF0YVR5cGV9YCwgKCkgPT4ge1xuICAgICAgICAgIGV4cGVjdChib3VuZC5tdXRhYmxlKS50b0VxdWFsKGZhbHNlKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1N0cmluZ0F0dHJpYnV0ZScsICgpID0+IHtcbiAgICB0ZXN0KCdkZWZhdWx0JywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IGF0dHIgPSBuZXcgU3RyaW5nQXR0cmlidXRlKCk7XG5cbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGJvdW5kID0gYXR0ci5iaW5kKCk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChib3VuZC5kYXRhVHlwZSkudG9FcXVhbCgnU3RyaW5nJyk7XG4gICAgICBleHBlY3QoYm91bmQuc3RyaW5nQ29uc3RyYWludHMpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIGV4cGVjdChib3VuZC5udW1iZXJDb25zdHJhaW50cykudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc3BlY2lmaWVkIGNvbnN0cmFpbnRzIGFyZSByZWNvZ25pemVkJywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IGF0dHIgPSBuZXcgU3RyaW5nQXR0cmlidXRlKHsgbWluTGVuOiAxMCwgbWF4TGVuOiA2MCB9KTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgYm91bmQgPSBhdHRyLmJpbmQoKTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KGJvdW5kLnN0cmluZ0NvbnN0cmFpbnRzKS50b0VxdWFsKHtcbiAgICAgICAgbWluTGVuOiAxMCxcbiAgICAgICAgbWF4TGVuOiA2MCxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGJvdW5kLm51bWJlckNvbnN0cmFpbnRzKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCd0aHJvd3MgZXJyb3Igd2hlbiBjcm9zc2luZyBsaW1pdHMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QoKCkgPT4gbmV3IFN0cmluZ0F0dHJpYnV0ZSh7IG1pbkxlbjogLTEwIH0pKVxuICAgICAgICAudG9UaHJvdygvbWluTGVuIGNhbm5vdCBiZSBsZXNzIHRoYW4vKTtcbiAgICAgIGV4cGVjdCgoKSA9PiBuZXcgU3RyaW5nQXR0cmlidXRlKHsgbWF4TGVuOiA1MDAwIH0pKVxuICAgICAgICAudG9UaHJvdygvbWF4TGVuIGNhbm5vdCBiZSBncmVhdGVyIHRoYW4vKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3ZhbGlkYXRpb24gaXMgc2tpcHBlZCB3aGVuIG1pbkxlbiBvciBtYXhMZW4gYXJlIHRva2VucycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgICBjb25zdCBwYXJhbWV0ZXIgPSBuZXcgQ2ZuUGFyYW1ldGVyKHN0YWNrLCAnUGFyYW1ldGVyJywge1xuICAgICAgICB0eXBlOiAnTnVtYmVyJyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoKCkgPT4gbmV3IFN0cmluZ0F0dHJpYnV0ZSh7IG1pbkxlbjogcGFyYW1ldGVyLnZhbHVlQXNOdW1iZXIgfSkpXG4gICAgICAgIC5ub3QudG9UaHJvdygpO1xuICAgICAgZXhwZWN0KCgpID0+IG5ldyBTdHJpbmdBdHRyaWJ1dGUoeyBtYXhMZW46IHBhcmFtZXRlci52YWx1ZUFzTnVtYmVyIH0pKVxuICAgICAgICAubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ051bWJlckF0dHJpYnV0ZScsICgpID0+IHtcbiAgICB0ZXN0KCdkZWZhdWx0JywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IGF0dHIgPSBuZXcgTnVtYmVyQXR0cmlidXRlKCk7XG5cbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGJvdW5kID0gYXR0ci5iaW5kKCk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChib3VuZC5kYXRhVHlwZSkudG9FcXVhbCgnTnVtYmVyJyk7XG4gICAgICBleHBlY3QoYm91bmQuc3RyaW5nQ29uc3RyYWludHMpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIGV4cGVjdChib3VuZC5udW1iZXJDb25zdHJhaW50cykudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc3BlY2lmaWVkIGNvbnN0cmFpbnRzIGFyZSByZWNvZ25pemVkJywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IGF0dHIgPSBuZXcgTnVtYmVyQXR0cmlidXRlKHsgbWluOiA1LCBtYXg6IDYwMCB9KTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgYm91bmQgPSBhdHRyLmJpbmQoKTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KGJvdW5kLm51bWJlckNvbnN0cmFpbnRzKS50b0VxdWFsKHtcbiAgICAgICAgbWluOiA1LFxuICAgICAgICBtYXg6IDYwMCxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGJvdW5kLnN0cmluZ0NvbnN0cmFpbnRzKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdCb29sZWFuQXR0cmlidXRlJywgKCkgPT4ge1xuICAgIHRlc3QoJ2RlZmF1bHQnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3QgYXR0ciA9IG5ldyBCb29sZWFuQXR0cmlidXRlKCk7XG5cbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGJvdW5kID0gYXR0ci5iaW5kKCk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChib3VuZC5kYXRhVHlwZSkudG9FcXVhbCgnQm9vbGVhbicpO1xuICAgICAgZXhwZWN0KGJvdW5kLnN0cmluZ0NvbnN0cmFpbnRzKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QoYm91bmQubnVtYmVyQ29uc3RyYWludHMpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RhdGVUaW1lQXR0cmlidXRlJywgKCkgPT4ge1xuICAgIHRlc3QoJ2RlZmF1bHQnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3QgYXR0ciA9IG5ldyBEYXRlVGltZUF0dHJpYnV0ZSgpO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBib3VuZCA9IGF0dHIuYmluZCgpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBleHBlY3QoYm91bmQuZGF0YVR5cGUpLnRvRXF1YWwoJ0RhdGVUaW1lJyk7XG4gICAgICBleHBlY3QoYm91bmQuc3RyaW5nQ29uc3RyYWludHMpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIGV4cGVjdChib3VuZC5udW1iZXJDb25zdHJhaW50cykudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQ2xpZW50QXR0cmlidXRlcycsICgpID0+IHtcbiAgICB0ZXN0KCdjcmVhdGUgZW1wdHkgQ2xpZW50QXR0cmlidXRlcycsICgpID0+IHtcbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGNsaWVudEF0dHJpYnV0ZXMgPSAobmV3IENsaWVudEF0dHJpYnV0ZXMoKSk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChjbGllbnRBdHRyaWJ1dGVzLmF0dHJpYnV0ZXMoKSkudG9TdHJpY3RFcXVhbChbXSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdjcmVhdGUgQ2xpZW50QXR0cmlidXRlcyB3aXRoIGFsbCBzdGFuZGFyZCBhdHRyaWJ1dGVzJywgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIGNvbnN0IGN1c3RvbUF0dHJpYnV0ZXMgPSBbJ2N1c3RvbTpteV9hdHRyaWJ1dGUnXTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgY2xpZW50QXR0cmlidXRlcyA9IChuZXcgQ2xpZW50QXR0cmlidXRlcygpKS53aXRoU3RhbmRhcmRBdHRyaWJ1dGVzKHtcbiAgICAgICAgYWRkcmVzczogdHJ1ZSxcbiAgICAgICAgYmlydGhkYXRlOiB0cnVlLFxuICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgZW1haWxWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgZmFtaWx5TmFtZTogdHJ1ZSxcbiAgICAgICAgZnVsbG5hbWU6IHRydWUsXG4gICAgICAgIGdlbmRlcjogdHJ1ZSxcbiAgICAgICAgZ2l2ZW5OYW1lOiB0cnVlLFxuICAgICAgICBsYXN0VXBkYXRlVGltZTogdHJ1ZSxcbiAgICAgICAgbG9jYWxlOiB0cnVlLFxuICAgICAgICBtaWRkbGVOYW1lOiB0cnVlLFxuICAgICAgICBuaWNrbmFtZTogdHJ1ZSxcbiAgICAgICAgcGhvbmVOdW1iZXI6IHRydWUsXG4gICAgICAgIHBob25lTnVtYmVyVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgIHByZWZlcnJlZFVzZXJuYW1lOiB0cnVlLFxuICAgICAgICBwcm9maWxlUGFnZTogdHJ1ZSxcbiAgICAgICAgcHJvZmlsZVBpY3R1cmU6IHRydWUsXG4gICAgICAgIHRpbWV6b25lOiB0cnVlLFxuICAgICAgICB3ZWJzaXRlOiB0cnVlLFxuICAgICAgfSkud2l0aEN1c3RvbUF0dHJpYnV0ZXMoLi4uY3VzdG9tQXR0cmlidXRlcyk7XG4gICAgICBjb25zdCBhdHRyaWJ1dGVzID0gY2xpZW50QXR0cmlidXRlcy5hdHRyaWJ1dGVzKCk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChhdHRyaWJ1dGVzLmxlbmd0aCkudG9FcXVhbCgyMCk7XG4gICAgICBleHBlY3QoYXR0cmlidXRlcykudG9Db250YWluKCdwcmVmZXJyZWRfdXNlcm5hbWUnKTtcbiAgICAgIGV4cGVjdChhdHRyaWJ1dGVzKS50b0NvbnRhaW4oJ2VtYWlsX3ZlcmlmaWVkJyk7XG4gICAgICBleHBlY3QoYXR0cmlidXRlcykudG9Db250YWluKCdwaG9uZV9udW1iZXJfdmVyaWZpZWQnKTtcbiAgICAgIGV4cGVjdChhdHRyaWJ1dGVzKS50b0NvbnRhaW4oJ2N1c3RvbTpteV9hdHRyaWJ1dGUnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2NyZWF0ZSBDbGllbnRBdHRyaWJ1dGVzIGNvcHlpbmcgYW5vdGhlciBvbmUnLCAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3Qgb3JpZ2luYWwgPSAobmV3IENsaWVudEF0dHJpYnV0ZXMoKSlcbiAgICAgICAgLndpdGhTdGFuZGFyZEF0dHJpYnV0ZXMoeyBlbWFpbDogdHJ1ZSB9KVxuICAgICAgICAud2l0aEN1c3RvbUF0dHJpYnV0ZXMoJ2N1c3RvbTEnKTtcbiAgICAgIGNvbnN0IGNvcGllZCA9IG9yaWdpbmFsXG4gICAgICAgIC53aXRoU3RhbmRhcmRBdHRyaWJ1dGVzKHsgZW1haWxWZXJpZmllZDogdHJ1ZSB9KVxuICAgICAgICAud2l0aEN1c3RvbUF0dHJpYnV0ZXMoJ2N1c3RvbTInKTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3Qgb3JpZ2luYWxBdHRyaWJ1dGVzID0gb3JpZ2luYWwuYXR0cmlidXRlcygpO1xuICAgICAgY29uc3QgY29waWVkQXR0cmlidXRlcyA9IGNvcGllZC5hdHRyaWJ1dGVzKCk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChvcmlnaW5hbEF0dHJpYnV0ZXMubGVuZ3RoKS50b0VxdWFsKDIpO1xuICAgICAgZXhwZWN0KGNvcGllZEF0dHJpYnV0ZXMubGVuZ3RoKS50b0VxdWFsKDQpO1xuICAgICAgLy8gb3JpZ2luYWxzIE1VU1QgTk9UIGNvbnRhaW4gdGhlIGFkZGVkIG9uZXNcbiAgICAgIGV4cGVjdChvcmlnaW5hbEF0dHJpYnV0ZXMpLnRvQ29udGFpbignZW1haWwnKTtcbiAgICAgIGV4cGVjdChvcmlnaW5hbEF0dHJpYnV0ZXMpLnRvQ29udGFpbignY3VzdG9tOmN1c3RvbTEnKTtcbiAgICAgIGV4cGVjdChvcmlnaW5hbEF0dHJpYnV0ZXMpLm5vdC50b0NvbnRhaW4oJ2VtYWlsX3ZlcmlmaWVkJyk7XG4gICAgICBleHBlY3Qob3JpZ2luYWxBdHRyaWJ1dGVzKS5ub3QudG9Db250YWluKCdjdXN0b206Y3VzdG9tMicpO1xuICAgICAgLy8gY29waWVkIE1VU1QgY29udGFpbiBhbGwgYXR0cmlidXRlc1xuICAgICAgZXhwZWN0KGNvcGllZEF0dHJpYnV0ZXMpLnRvQ29udGFpbignZW1haWwnKTtcbiAgICAgIGV4cGVjdChjb3BpZWRBdHRyaWJ1dGVzKS50b0NvbnRhaW4oJ2N1c3RvbTpjdXN0b20xJyk7XG4gICAgICBleHBlY3QoY29waWVkQXR0cmlidXRlcykudG9Db250YWluKCdlbWFpbF92ZXJpZmllZCcpO1xuICAgICAgZXhwZWN0KGNvcGllZEF0dHJpYnV0ZXMpLnRvQ29udGFpbignY3VzdG9tOmN1c3RvbTInKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2NyZWF0ZSBDbGllbnRBdHRyaWJ1dGVzIHdpdGggY3VzdG9tIGF0dHJpYnV0ZXMgb25seScsICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBjb25zdCBjdXN0b21BdHRyaWJ1dGVzID0gWydjdXN0b206bXlfZmlyc3QnLCAnbXlfc2Vjb25kJ107XG5cbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGNsaWVudEF0dHJpYnV0ZXMgPSAobmV3IENsaWVudEF0dHJpYnV0ZXMoKSkud2l0aEN1c3RvbUF0dHJpYnV0ZXMoLi4uY3VzdG9tQXR0cmlidXRlcyk7XG4gICAgICBjb25zdCBhdHRyaWJ1dGVzID0gY2xpZW50QXR0cmlidXRlcy5hdHRyaWJ1dGVzKCk7XG5cbiAgICAgIC8vIEVYUEVDVFxuICAgICAgZXhwZWN0KGF0dHJpYnV0ZXMubGVuZ3RoKS50b0VxdWFsKDIpO1xuICAgICAgZXhwZWN0KGF0dHJpYnV0ZXMpLnRvQ29udGFpbignY3VzdG9tOm15X2ZpcnN0Jyk7XG4gICAgICBleHBlY3QoYXR0cmlidXRlcykudG9Db250YWluKCdjdXN0b206bXlfc2Vjb25kJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdjcmVhdGUgQ2xpZW50QXR0cmlidXRlcyB3aXRoIGFsbCBTdGFuZGFyZEF0dHJpYnV0ZU5hbWVzJywgKCkgPT4ge1xuICAgICAgLy8gdGhpcyB0ZXN0IGlzIGludGVuZGVkIHRvIGNoZWNrIGlmIGNoYW5nZXMgaW4gdGhlIGBTdGFuZGFyZEF0dHJpYnV0ZU5hbWVzYCBjb25zdGFudFxuICAgICAgLy8gZG9lcyBub3QgcmVmbGVjdCBhcyBjaGFuZ2VzIGluIHRoZSBgU3RhbmRhcmRBdHRyaWJ1dGVzTWFza2BcbiAgICAgIC8vIEdJVkVOXG4gICAgICBsZXQgYWxsU3RhbmRhcmRBdHRyaWJ1dGVzID0ge30gYXMgYW55O1xuICAgICAgbGV0IHN0YW5kYXJkQXR0cmlidXRlTmFtZXNDb3VudCA9IDA7IC8vIHRoZSBjb3VudCBvZiBTdGFuZGFyZEF0dHJpYnV0ZU5hbWVzXG4gICAgICAvLyBpdGVyYXRlIHRocm91Z2ggdGhlIHN0YW5kYXJkIGF0dHJpYnV0ZSBuYW1lc1xuICAgICAgZm9yIChjb25zdCBhdHRyaWJ1dGVLZXkgaW4gU3RhbmRhcmRBdHRyaWJ1dGVOYW1lcykge1xuICAgICAgICBzdGFuZGFyZEF0dHJpYnV0ZU5hbWVzQ291bnQgKz0gMTtcbiAgICAgICAgZXhwZWN0KFN0YW5kYXJkQXR0cmlidXRlTmFtZXMpLnRvSGF2ZVByb3BlcnR5KGF0dHJpYnV0ZUtleSk7XG4gICAgICAgIC8vIGFkZCB0aGUgc3RhbmRhcmQgYXR0cmlidXRlXG4gICAgICAgIGFsbFN0YW5kYXJkQXR0cmlidXRlc1thdHRyaWJ1dGVLZXldID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgYXR0cmlidXRlcyA9IChuZXcgQ2xpZW50QXR0cmlidXRlcygpKS53aXRoU3RhbmRhcmRBdHRyaWJ1dGVzKGFsbFN0YW5kYXJkQXR0cmlidXRlcykuYXR0cmlidXRlcygpO1xuXG4gICAgICAvLyBFWFBFQ1RcbiAgICAgIGV4cGVjdChhdHRyaWJ1dGVzLmxlbmd0aCkudG9FcXVhbChzdGFuZGFyZEF0dHJpYnV0ZU5hbWVzQ291bnQpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19